(()=>{"use strict";var e={329:(t,e,n)=>{n.d(e,{Z:()=>a});var r=n(81),i=n.n(r),o=n(645),s=n.n(o)()(i());s.push([t.id,'.clr-picker {\r\n  display: none;\r\n  flex-wrap: wrap;\r\n  position: absolute;\r\n  width: 200px;\r\n  z-index: 1000;\r\n  border-radius: 10px;\r\n  background-color: #fff;\r\n  justify-content: space-between;\r\n  box-shadow: 0 0 5px rgba(0,0,0,.05), 0 5px 20px rgba(0,0,0,.1);\r\n  -moz-user-select: none;\r\n  -webkit-user-select: none;\r\n  user-select: none;\r\n}\r\n\r\n.clr-picker.clr-open,\r\n.clr-picker[data-inline="true"] {\r\n  display: flex;\r\n}\r\n\r\n.clr-picker[data-inline="true"] {\r\n  position: relative;\r\n}\r\n\r\n.clr-gradient {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100px;\r\n  margin-bottom: 15px;\r\n  border-radius: 3px 3px 0 0;\r\n  background-image: linear-gradient(rgba(0,0,0,0), #000), linear-gradient(90deg, #fff, currentColor);\r\n  cursor: pointer;\r\n}\r\n\r\n.clr-marker {\r\n  position: absolute;\r\n  width: 12px;\r\n  height: 12px;\r\n  margin: -6px 0 0 -6px;\r\n  border: 1px solid #fff;\r\n  border-radius: 50%;\r\n  background-color: currentColor;\r\n  cursor: pointer;\r\n}\r\n\r\n.clr-picker input[type="range"]::-webkit-slider-runnable-track {\r\n  width: 100%;\r\n  height: 8px;\r\n}\r\n\r\n.clr-picker input[type="range"]::-webkit-slider-thumb {\r\n  width: 8px;\r\n  height: 8px;\r\n  -webkit-appearance: none;\r\n}\r\n\r\n.clr-picker input[type="range"]::-moz-range-track {\r\n  width: 100%;\r\n  height: 8px;\r\n  border: 0;\r\n}\r\n\r\n.clr-picker input[type="range"]::-moz-range-thumb {\r\n  width: 8px;\r\n  height: 8px;\r\n  border: 0;\r\n}\r\n\r\n.clr-hue {\r\n  background-image: linear-gradient(to right, #f00 0%, #ff0 16.66%, #0f0 33.33%, #0ff 50%, #00f 66.66%, #f0f 83.33%, #f00 100%);\r\n}\r\n\r\n.clr-hue,\r\n.clr-alpha {\r\n  position: relative;\r\n  width: calc(100% - 40px);\r\n  height: 8px;\r\n  margin: 5px 20px;\r\n  border-radius: 4px;\r\n}\r\n\r\n.clr-alpha span {\r\n  display: block;\r\n  height: 100%;\r\n  width: 100%;\r\n  border-radius: inherit;\r\n  background-image: linear-gradient(90deg, rgba(0,0,0,0), currentColor);\r\n}\r\n\r\n.clr-hue input,\r\n.clr-alpha input {\r\n  position: absolute;\r\n  width: calc(100% + 16px);\r\n  height: 16px;\r\n  left: -8px;\r\n  top: -4px;\r\n  margin: 0;\r\n  background-color: transparent;\r\n  opacity: 0;\r\n  cursor: pointer;\r\n  appearance: none;\r\n  -webkit-appearance: none;\r\n}\r\n\r\n.clr-hue div,\r\n.clr-alpha div {\r\n  position: absolute;\r\n  width: 16px;\r\n  height: 16px;\r\n  left: 0;\r\n  top: 50%;\r\n  margin-left: -8px;\r\n  transform: translateY(-50%);\r\n  border: 2px solid #fff;\r\n  border-radius: 50%;\r\n  background-color: currentColor;\r\n  box-shadow: 0 0 1px #888;\r\n  pointer-events: none;\r\n}\r\n\r\n.clr-alpha div:before {\r\n  content: \'\';\r\n  position: absolute;\r\n  height: 100%;\r\n  width: 100%;\r\n  left: 0;\r\n  top: 0;\r\n  border-radius: 50%;\r\n  background-color: currentColor;\r\n}\r\n\r\n.clr-format {\r\n  display: none;\r\n  order: 1;\r\n  width: calc(100% - 40px);\r\n  margin: 0 20px 20px;\r\n}\r\n\r\n.clr-segmented {\r\n  display: flex;\r\n  position: relative;\r\n  width: 100%;\r\n  margin: 0;\r\n  padding: 0;\r\n  border: 1px solid #ddd;\r\n  border-radius: 15px;\r\n  box-sizing: border-box;\r\n  color: #999;\r\n  font-size: 12px;\r\n}\r\n\r\n.clr-segmented input,\r\n.clr-segmented legend {\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 100%;\r\n  margin: 0;\r\n  padding: 0;\r\n  border: 0;\r\n  left: 0;\r\n  top: 0;\r\n  opacity: 0;\r\n  pointer-events: none;\r\n}\r\n\r\n.clr-segmented label {\r\n  flex-grow: 1;\r\n  padding: 4px 0;\r\n  text-align: center;\r\n  cursor: pointer;\r\n}\r\n\r\n.clr-segmented label:first-of-type {\r\n  border-radius: 10px 0 0 10px;\r\n}\r\n\r\n.clr-segmented label:last-of-type {\r\n  border-radius: 0 10px 10px 0;\r\n}\r\n\r\n.clr-segmented input:checked + label {\r\n  color: #fff;\r\n  background-color: #666;\r\n}\r\n\r\n.clr-swatches {\r\n  order: 2;\r\n  width: calc(100% - 32px);\r\n  margin: 0 16px;\r\n}\r\n\r\n.clr-swatches div {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  padding-bottom: 12px;\r\n  justify-content: center;\r\n}\r\n\r\n.clr-swatches button {\r\n  position: relative;\r\n  width: 20px;\r\n  height: 20px;\r\n  margin: 0 4px 6px 4px;\r\n  border: 0;\r\n  border-radius: 50%;\r\n  color: inherit;\r\n  text-indent: -1000px;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  cursor: pointer;\r\n}\r\n\r\n.clr-swatches button:after {\r\n  content: \'\';\r\n  display: block;\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 100%;\r\n  left: 0;\r\n  top: 0;\r\n  border-radius: inherit;\r\n  background-color: currentColor;\r\n  box-shadow: inset 0 0 0 1px rgba(0,0,0,.1);\r\n}\r\n\r\ninput.clr-color {\r\n  order: 1;\r\n  width: calc(100% - 80px);\r\n  height: 32px;\r\n  margin: 15px 20px 20px 0;\r\n  padding: 0 10px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 16px;\r\n  color: #444;\r\n  background-color: #fff;\r\n  font-family: sans-serif;\r\n  font-size: 14px;\r\n  text-align: center;\r\n  box-shadow: none;\r\n}\r\n\r\ninput.clr-color:focus {\r\n  outline: none;\r\n  border: 1px solid #1e90ff;\r\n}\r\n\r\n.clr-clear {\r\n  display: none;\r\n  order: 2;\r\n  height: 24px;\r\n  margin: 0 20px 20px auto;\r\n  padding: 0 20px;\r\n  border: 0;\r\n  border-radius: 12px;\r\n  color: #fff;\r\n  background-color: #666;\r\n  font-family: inherit;\r\n  font-size: 12px;\r\n  font-weight: 400;\r\n  cursor: pointer;\r\n}\r\n\r\n.clr-preview {\r\n  position: relative;\r\n  width: 32px;\r\n  height: 32px;\r\n  margin: 15px 0 20px 20px;\r\n  border: 0;\r\n  border-radius: 50%;\r\n  overflow: hidden;\r\n  cursor: pointer;\r\n}\r\n\r\n.clr-preview:before,\r\n.clr-preview:after {\r\n  content: \'\';\r\n  position: absolute;\r\n  height: 100%;\r\n  width: 100%;\r\n  left: 0;\r\n  top: 0;\r\n  border: 1px solid #fff;\r\n  border-radius: 50%;\r\n}\r\n\r\n.clr-preview:after {\r\n  border: 0;\r\n  background-color: currentColor;\r\n  box-shadow: inset 0 0 0 1px rgba(0,0,0,.1);\r\n}\r\n\r\n.clr-marker,\r\n.clr-hue div,\r\n.clr-alpha div,\r\n.clr-color {\r\n  box-sizing: border-box;\r\n}\r\n\r\n.clr-field {\r\n  display: inline-block;\r\n  position: relative;\r\n  color: transparent;\r\n}\r\n\r\n.clr-field button {\r\n  position: absolute;\r\n  width: 30px;\r\n  height: 100%;\r\n  right: 0;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  border: 0;\r\n  color: inherit;\r\n  text-indent: -1000px;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  pointer-events: none;\r\n}\r\n\r\n.clr-field button:after {\r\n  content: \'\';\r\n  display: block;\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 100%;\r\n  left: 0;\r\n  top: 0;\r\n  border-radius: inherit;\r\n  background-color: currentColor;\r\n  box-shadow: inset 0 0 1px rgba(0,0,0,.5);\r\n}\r\n\r\n.clr-alpha,\r\n.clr-alpha div,\r\n.clr-swatches button,\r\n.clr-preview:before,\r\n.clr-field button {\r\n  background-image: repeating-linear-gradient(45deg, #aaa 25%, transparent 25%, transparent 75%, #aaa 75%, #aaa), repeating-linear-gradient(45deg, #aaa 25%, #fff 25%, #fff 75%, #aaa 75%, #aaa);\r\n  background-position: 0 0, 4px 4px;\r\n  background-size: 8px 8px;\r\n}\r\n\r\n.clr-marker:focus {\r\n  outline: none;\r\n}\r\n\r\n.clr-keyboard-nav .clr-marker:focus,\r\n.clr-keyboard-nav .clr-hue input:focus + div,\r\n.clr-keyboard-nav .clr-alpha input:focus + div,\r\n.clr-keyboard-nav .clr-segmented input:focus + label {\r\n  outline: none;\r\n  box-shadow: 0 0 0 2px #1e90ff, 0 0 2px 2px #fff;\r\n}\r\n\r\n.clr-picker[data-alpha="false"] .clr-alpha {\r\n  display: none;\r\n}\r\n\r\n.clr-picker[data-minimal="true"] {\r\n  padding-top: 16px;\r\n}\r\n\r\n.clr-picker[data-minimal="true"] .clr-gradient,\r\n.clr-picker[data-minimal="true"] .clr-hue,\r\n.clr-picker[data-minimal="true"] .clr-alpha,\r\n.clr-picker[data-minimal="true"] .clr-color,\r\n.clr-picker[data-minimal="true"] .clr-preview {\r\n  display: none;\r\n}\r\n\r\n/** Dark theme **/\r\n\r\n.clr-dark {\r\n  background-color: #444;\r\n}\r\n\r\n.clr-dark .clr-segmented {\r\n  border-color: #777;\r\n}\r\n\r\n.clr-dark .clr-swatches button:after {\r\n  box-shadow: inset 0 0 0 1px rgba(255,255,255,.3);\r\n}\r\n\r\n.clr-dark input.clr-color {\r\n  color: #fff;\r\n  border-color: #777;\r\n  background-color: #555;\r\n}\r\n\r\n.clr-dark input.clr-color:focus {\r\n  border-color: #1e90ff;\r\n}\r\n\r\n.clr-dark .clr-preview:after {\r\n  box-shadow: inset 0 0 0 1px rgba(255,255,255,.5);\r\n}\r\n\r\n.clr-dark .clr-alpha,\r\n.clr-dark .clr-alpha div,\r\n.clr-dark .clr-swatches button,\r\n.clr-dark .clr-preview:before {\r\n  background-image: repeating-linear-gradient(45deg, #666 25%, transparent 25%, transparent 75%, #888 75%, #888), repeating-linear-gradient(45deg, #888 25%, #444 25%, #444 75%, #888 75%, #888);\r\n}\r\n\r\n/** Polaroid theme **/\r\n\r\n.clr-picker.clr-polaroid {\r\n  border-radius: 6px;\r\n  box-shadow: 0 0 5px rgba(0,0,0,.1), 0 5px 30px rgba(0,0,0,.2);\r\n}\r\n\r\n.clr-picker.clr-polaroid:before {\r\n  content: \'\';\r\n  display: block;\r\n  position: absolute;\r\n  width: 16px;\r\n  height: 10px;\r\n  left: 20px;\r\n  top: -10px;\r\n  border: solid transparent;\r\n  border-width: 0 8px 10px 8px;\r\n  border-bottom-color: currentColor;\r\n  box-sizing: border-box;\r\n  color: #fff;\r\n  filter: drop-shadow(0 -4px 3px rgba(0,0,0,.1));\r\n  pointer-events: none;\r\n}\r\n\r\n.clr-picker.clr-polaroid.clr-dark:before {\r\n  color: #444;\r\n}\r\n\r\n.clr-picker.clr-polaroid.clr-left:before {\r\n  left: auto;\r\n  right: 20px;\r\n}\r\n\r\n.clr-picker.clr-polaroid.clr-top:before {\r\n  top: auto;\r\n  bottom: -10px;\r\n  transform: rotateZ(180deg);\r\n}\r\n\r\n.clr-polaroid .clr-gradient {\r\n  width: calc(100% - 20px);\r\n  height: 120px;\r\n  margin: 10px;\r\n  border-radius: 3px;\r\n}\r\n\r\n.clr-polaroid .clr-hue,\r\n.clr-polaroid .clr-alpha {\r\n  width: calc(100% - 30px);\r\n  height: 10px;\r\n  margin: 6px 15px;\r\n  border-radius: 5px;\r\n}\r\n\r\n.clr-polaroid .clr-hue div,\r\n.clr-polaroid .clr-alpha div {\r\n  box-shadow: 0 0 5px rgba(0,0,0,.2);\r\n}\r\n\r\n.clr-polaroid .clr-format {\r\n  width: calc(100% - 20px);\r\n  margin: 0 10px 15px;\r\n}\r\n\r\n.clr-polaroid .clr-swatches {\r\n  width: calc(100% - 12px);\r\n  margin: 0 6px;\r\n}\r\n.clr-polaroid .clr-swatches div {\r\n  padding-bottom: 10px;\r\n}\r\n\r\n.clr-polaroid .clr-swatches button {\r\n  width: 22px;\r\n  height: 22px;\r\n}\r\n\r\n.clr-polaroid input.clr-color {\r\n  width: calc(100% - 60px);\r\n  margin: 10px 10px 15px 0;\r\n}\r\n\r\n.clr-polaroid .clr-clear {\r\n  margin: 0 10px 15px auto;\r\n}\r\n\r\n.clr-polaroid .clr-preview {\r\n  margin: 10px 0 15px 10px;\r\n}\r\n\r\n/** Large theme **/\r\n\r\n.clr-picker.clr-large {\r\n  width: 275px;\r\n}\r\n\r\n.clr-large .clr-gradient {\r\n  height: 150px;\r\n}\r\n\r\n.clr-large .clr-swatches button {\r\n  width: 22px;\r\n  height: 22px;\r\n}\r\n\r\n/** Pill (horizontal) theme **/\r\n\r\n.clr-picker.clr-pill {\r\n  width: 380px;\r\n  padding-left: 180px;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.clr-pill .clr-gradient {\r\n  position: absolute;\r\n  width: 180px;\r\n  height: 100%;\r\n  left: 0;\r\n  top: 0;\r\n  margin-bottom: 0;\r\n  border-radius: 3px 0 0 3px;\r\n}\r\n\r\n.clr-pill .clr-hue {\r\n  margin-top: 20px;\r\n}',""]);const a=s},287:(t,e,n)=>{n.d(e,{Z:()=>c});var r=n(81),i=n.n(r),o=n(645),s=n.n(o),a=n(989),l=s()(i());l.i(a.Z),l.push([t.id,"\n.imageEditorContainer {\n\t/* Deafult colors for the editor */\n    --primary-background-color: white;\n    --primary-background-color-transparent: rgba(255, 255, 255, 0.5);\n    --secondary-background-color: #faf;\n    --primary-foreground-color: black;\n    --secondary-foreground-color: black;\n}\n\n@media (prefers-color-scheme: dark) {\n\t.imageEditorContainer {\n\t\t/* Deafult colors for the editor */\n\t\t--primary-background-color: #151515;\n\t\t--primary-background-color-transparent: rgba(50, 50, 50, 0.5);\n\t\t--secondary-background-color: #607;\n\t\t--primary-foreground-color: white;\n\t\t--secondary-foreground-color: white;\n\t}\n}\n\n.imageEditorContainer {\n\tcolor: var(--primary-foreground-color);\n\tfont-family: system-ui, -apple-system, sans-serif;\n\tbackground-color: var(--primary-background-color);\n\n\tdisplay: flex;\n\tflex-direction: column-reverse;\n}\n\n.imageEditorContainer .imageEditorRenderArea {\n\tdisplay: grid;\n\tgrid-template-columns: 1fr;\n\tflex-grow: 2;\n\tflex-shrink: 1;\n\tmin-height: 100px;\n}\n\n.imageEditorContainer .imageEditorRenderArea canvas {\n\t/* Stack all canvases on top of each other */\n\tgrid-row: 1 / 1;\n\tgrid-column: 1 / 1;\n\ttouch-action: none;\n\n\t/* Fill the container */\n\tbox-sizing: border-box;\n\twidth: 100%;\n\theight: 100%;\n}\n\n.imageEditorContainer .loadingMessage {\n\tposition: fixed;\n\ttext-align: center;\n\tfont-size: 2em;\n\n\tbottom: 0;\n\tleft: 0;\n\tright: 0;\n}\n\n.imageEditorContainer .accessibilityAnnouncement {\n\topacity: 0;\n\twidth: 0;\n\theight: 0;\n\toverflow: hidden;\n\tpointer-events: none;\n}\n",""]);const c=l},989:(t,e,n)=>{n.d(e,{Z:()=>a});var r=n(81),i=n.n(r),o=n(645),s=n.n(o)()(i());s.push([t.id,".toolbar-root {\n    background-color: var(--primary-background-color);\n\n    border: 1px solid var(--secondary-background-color);\n    border-radius: 2px;\n    flex-wrap: wrap;\n\n    box-sizing: border-box;\n    width: 100%;\n\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n\n    font-family: system-ui, -apple-system, sans-serif;\n}\n\n.toolbar-button, .toolbar-root button {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n\n    text-align: center;\n    border-radius: 6px;\n    cursor: pointer;\n\n    padding-left: 3px;\n    padding-right: 3px;\n    margin-left: 3px;\n    margin-right: 3px;\n\n    min-width: 40px;\n    max-width: 70px;\n    font-size: 11pt;\n\n    cursor: pointer;\n\n    height: min(20vh, 60px);\n    background-color: var(--primary-background-color);\n    color: var(--primary-foreground-color);\n    border: none;\n    box-shadow: 0px 0px 2px var(--primary-foreground-color);\n\n    transition: background-color 0.25s ease, box-shadow 0.25s ease, opacity 0.3s ease;\n}\n\n.toolbar-button:hover, .toolbar-root button:not(:disabled):hover {\n    box-shadow: 0px 2px 4px var(--primary-foreground-color);\n}\n\n.toolbar-root button {\n    height: auto;\n}\n\n.toolbar-root button:disabled {\n    cursor: inherit;\n    filter: opacity(0.5);\n}\n\n.toolbar-button .toolbar-icon {\n    flex-shrink: 1;\n    min-width: 30px;\n}\n\n.toolbar-toolContainer.selected .toolbar-button {\n    background-color: var(--secondary-background-color);\n    color: var(--secondary-foreground-color);\n}\n\n.toolbar-toolContainer:not(.selected) .toolbar-showHideDropdownIcon {\n    display: none;\n}\n\n.toolbar-toolContainer.selected .toolbar-showHideDropdownIcon {\n    height: 10px;\n    transition: transform 0.5s ease;\n}\n\n.toolbar-toolContainer.dropdownVisible .toolbar-showHideDropdownIcon {\n    transform: rotate(180deg);\n}\n\n.toolbar-dropdown.hidden, .toolbar-toolContainer:not(.selected) > .toolbar-dropdown {\n    display: none;\n}\n\n.toolbar-dropdown {\n    position: absolute;\n    padding: 15px;\n    padding-top: 5px;\n    /* Prevent overlap/being displayed under the undo/redo buttons */\n    z-index: 2;\n    background-color: var(--primary-background-color);\n    box-shadow: 0px 3px 3px var(--primary-foreground-color);\n}\n\n.toolbar-buttonGroup {\n    display: flex;\n    flex-direction: row;\n}\n\n.toolbar-closeColorPickerOverlay {\n    display: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n\n    background-color: var(--primary-background-color);\n    opacity: 0.3;\n}\n\n/* Make color selection buttons fill their containing label */\n.toolbar-dropdown .clr-field button {\n    width: 100%;\n    height: 100%;\n    border-radius: 2px;\n    margin-left: 0;\n    margin-right: 0;\n}\n",""]);const a=s},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",r=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),r&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),r&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,r,i,o){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(r)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var c=0;c<t.length;c++){var h=[].concat(t[c]);r&&s[h[0]]||(void 0!==o&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=o),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),i&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=i):h[4]="".concat(i)),e.push(h))}},e}},81:t=>{t.exports=function(t){return t[1]}},379:t=>{var e=[];function n(t){for(var n=-1,r=0;r<e.length;r++)if(e[r].identifier===t){n=r;break}return n}function r(t,r){for(var o={},s=[],a=0;a<t.length;a++){var l=t[a],c=r.base?l[0]+r.base:l[0],h=o[c]||0,d="".concat(c," ").concat(h);o[c]=h+1;var u=n(d),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)e[u].references++,e[u].updater(p);else{var f=i(p,r);r.byIndex=a,e.splice(a,0,{identifier:d,updater:f,references:1})}s.push(d)}return s}function i(t,e){var n=e.domAPI(e);n.update(t);return function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,i){var o=r(t=t||[],i=i||{});return function(t){t=t||[];for(var s=0;s<o.length;s++){var a=n(o[s]);e[a].references--}for(var l=r(t,i),c=0;c<o.length;c++){var h=n(o[c]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}o=l}}},569:t=>{var e={};t.exports=function(t,n){var r=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(r,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},n={};function r(t){var i=n[t];if(void 0!==i)return i.exports;var o=n[t]={id:t,exports:{}};return e[t](o,o.exports,r),o.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.nc=void 0;var i={};(()=>{r.r(i);class e{constructor(t,e,n){this.x=t,this.y=e,this.z=n}get xy(){return{x:this.x,y:this.y}}static of(t,n,r){return new e(t,n,r)}at(t){if(0===t)return this.x;if(1===t)return this.y;if(2===t)return this.z;throw new Error(`${t} out of bounds!`)}length(){return this.magnitude()}magnitude(){return Math.sqrt(this.dot(this))}magnitudeSquared(){return this.dot(this)}angle(){return Math.atan2(this.y,this.x)}normalized(){const t=this.magnitude();return e.of(this.x/t,this.y/t,this.z/t)}times(t){return e.of(this.x*t,this.y*t,this.z*t)}plus(t){return e.of(this.x+t.x,this.y+t.y,this.z+t.z)}minus(t){return this.plus(t.times(-1))}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return e.of(this.y*t.z-t.y*this.z,t.x*this.z-this.x*t.z,this.x*t.y-t.x*this.y)}orthog(){return 0===this.dot(e.unitX)&&0===this.dot(e.unitY)?0===this.dot(e.unitX)?e.unitX:this.cross(e.unitX).normalized():this.cross(e.unitZ.times(-1)).normalized()}extend(t,e){return this.plus(e.normalized().times(t))}lerp(t,e){return this.times(1-e).plus(t.times(e))}zip(t,n){return e.of(n(t.x,this.x),n(t.y,this.y),n(t.z,this.z))}map(t){return e.of(t(this.x),t(this.y),t(this.z))}asArray(){return[this.x,this.y,this.z]}eq(t,e){for(let n=0;n<3;n++)if(Math.abs(t.at(n)-this.at(n))>e)return!1;return!0}toString(){return`Vec(${this.x}, ${this.y}, ${this.z})`}}var n;e.unitX=e.of(1,0,0),e.unitY=e.of(0,1,0),e.unitZ=e.of(0,0,1),e.zero=e.of(0,0,0),function(t){t.of=(t,n)=>e.of(t,n,0),t.ofXY=({x:t,y:n})=>e.of(t,n,0),t.unitX=t.of(1,0),t.unitY=t.of(0,1),t.zero=t.of(0,0)}(n||(n={}));class o{constructor(t,e){this.point1=t,this.point2=e,this.bbox=s.bboxOf([t,e]),this.direction=e.minus(t),this.length=this.direction.magnitude(),this.length>0&&(this.direction=this.direction.times(1/this.length))}get p1(){return this.point1}get p2(){return this.point2}get(t){return this.point1.plus(this.direction.times(t))}intersection(t){let e,r;if(0===this.direction.x){if(0===t.direction.x||0===this.direction.y)return null;const i=this.point1.x,o=(this.point1.x-t.point1.x)*t.direction.y/t.direction.x+t.point1.y;e=n.of(i,o),r=(o-this.point1.y)/this.direction.y}else{const i=(this.point1.y-t.point1.y)*this.direction.x*t.direction.x+this.direction.x*t.direction.y*t.point1.x-this.direction.y*t.direction.x*this.point1.x,o=t.direction.y*this.direction.x-this.direction.y*t.direction.x;if(0===o)return null;const s=i/o,a=(s-this.point1.x)/this.direction.x,l=this.point1.y+this.direction.y*a;e=n.of(s,l),r=(s-this.point1.x)/this.direction.x}const i=e.minus(this.point1).magnitude(),o=e.minus(this.point2).magnitude(),s=e.minus(t.point1).magnitude(),a=e.minus(t.point2).magnitude();return i>this.length||o>this.length||s>t.length||a>t.length?null:{point:e,t:r}}}class s{constructor(t,e,r,i){this.x=t,this.y=e,this.w=r,this.h=i,r<0&&(this.x+=r,this.w=Math.abs(r)),i<0&&(this.y+=i,this.h=Math.abs(i)),this.topLeft=n.of(this.x,this.y),this.size=n.of(this.w,this.h),this.bottomRight=this.topLeft.plus(this.size),this.center=this.topLeft.plus(this.size.times(.5)),this.area=this.w*this.h}translatedBy(t){return new s(t.x+this.x,t.y+this.y,this.w,this.h)}resizedTo(t){return new s(this.x,this.y,t.x,t.y)}containsPoint(t){return this.x<=t.x&&this.y<=t.y&&this.x+this.w>=t.x&&this.y+this.h>=t.y}containsRect(t){return this.x<=t.x&&this.y<=t.y&&this.bottomRight.x>=t.bottomRight.x&&this.bottomRight.y>=t.bottomRight.y}intersects(t){return null!==this.intersection(t)}intersection(t){const e=this.topLeft.zip(t.topLeft,Math.max),n=this.bottomRight.zip(t.bottomRight,Math.min);return this.containsPoint(e)&&this.containsPoint(n)&&t.containsPoint(e)&&t.containsPoint(n)?s.fromCorners(e,n):null}union(t){const e=this.topLeft.zip(t.topLeft,Math.min),n=this.bottomRight.zip(t.bottomRight,Math.max);return s.fromCorners(e,n)}grownToPoint(t,e=0){const n=new s(t.x-e,t.y-e,2*e,2*e);return this.union(n)}grownBy(t){return new s(this.x-t,this.y-t,this.w+2*t,this.h+2*t)}get corners(){return[this.bottomRight,this.topRight,this.topLeft,this.bottomLeft]}get maxDimension(){return Math.max(this.w,this.h)}get topRight(){return this.bottomRight.plus(n.of(0,-this.h))}get bottomLeft(){return this.topLeft.plus(n.of(0,this.h))}getEdges(){const t=this.corners;return[new o(t[0],t[1]),new o(t[1],t[2]),new o(t[2],t[3]),new o(t[3],t[0])]}transformedBoundingBox(t){return s.bboxOf(this.corners.map((e=>t.transformVec2(e))))}eq(t,e=0){return this.topLeft.eq(t.topLeft,e)&&this.size.eq(t.size,e)}toString(){return`Rect(point(${this.x}, ${this.y}), size(${this.w}, ${this.h}))`}static fromCorners(t,e){return new s(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.abs(t.x-e.x),Math.abs(t.y-e.y))}static bboxOf(t,e=0){let r=0,i=0,o=0,a=0,l=!0;for(const e of t)l&&(r=e.x,i=e.y,o=e.x,a=e.y,l=!1),r=Math.min(r,e.x),i=Math.min(i,e.y),o=Math.max(o,e.x),a=Math.max(a,e.y);return s.fromCorners(n.of(r-e,i-e),n.of(o+e,a+e))}static of(t){var e,n,r,i;const o=null!==(n=null!==(e=t.width)&&void 0!==e?e:t.w)&&void 0!==n?n:0,a=null!==(i=null!==(r=t.height)&&void 0!==r?r:t.h)&&void 0!==i?i:0;return new s(t.x,t.y,o,a)}}s.empty=new s(0,0,0,0),s.unitSquare=new s(0,0,1,1);var a,l,c,h,d,u,p=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n},f=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)};class m{constructor(){this.root=new g}addElement(t){return this.root.addLeaf(t)}findParent(t){const e=this.root.getLeavesInRegion(t.getBBox());for(const n of e)if(n.getContent()===t)return n;return null}sortLeaves(t){t.sort(((t,e)=>t.getContent().zIndex-e.getContent().zIndex))}render(t,e,n=.001){const r=this.root.getLeavesInRegion(e.visibleRect,n);this.sortLeaves(r);for(const n of r)n.getContent().render(t,e.visibleRect)}renderAll(t){const e=this.root.getLeaves();this.sortLeaves(e);for(const n of e)n.getContent().render(t,n.getBBox())}getElementsIntersectingRegion(t){const e=this.root.getLeavesInRegion(t);return this.sortLeaves(e),e.map((t=>t.getContent()))}}m.AddElementCommand=(c=class{constructor(t,e=!1){a.set(this,void 0),l.set(this,!1),p(this,a,t,"f"),p(this,l,e,"f")}apply(t){t.image.addElement(f(this,a,"f")),f(this,l,"f")?(p(this,l,!1,"f"),t.display.flatten()):t.queueRerender()}unapply(t){const e=t.image.findParent(f(this,a,"f"));null==e||e.remove(),t.queueRerender()}description(t){return t.addElementAction(f(this,a,"f").description(t))}},a=new WeakMap,l=new WeakMap,c);class g{constructor(t=null){this.parent=t,this.targetChildCount=30,this.children=[],this.bbox=s.empty,this.content=null,this.minZIndex=null,this.maxZIndex=null}getContent(){return this.content}getParent(){return this.parent}getChildrenInRegion(t){return this.children.filter((e=>e.getBBox().intersects(t)))}getLeavesInRegion(t,e=0){const n=[];if(this.bbox.maxDimension/t.maxDimension<=e)return[];null!==this.content&&this.getBBox().intersects(t)&&n.push(this);const r=this.getChildrenInRegion(t);for(const i of r)n.push(...i.getLeavesInRegion(t,e));return n}getLeaves(){if(this.content)return[this];const t=[];for(const e of this.children)t.push(...e.getLeaves());return t}addLeaf(t){if(null===this.content&&0===this.children.length)return this.content=t,this.recomputeBBox(!0),this;if(null!==this.content){console.assert(0===this.children.length);const t=new g(this);t.content=this.content,this.content=null,this.children.push(t),t.recomputeBBox(!1)}const e=t.getBBox();if(e.containsRect(this.getBBox())){const e=new g(this),n=new g(this);return n.children=this.children,this.children=[e,n],n.recomputeBBox(!0),e.addLeaf(t)}const n=this.children.filter((t=>t.getBBox().containsRect(e)));if(n.length>0&&this.children.length>=this.targetChildCount){n.sort(((t,e)=>t.getBBox().area-e.getBBox().area));const e=n[0].addLeaf(t);return e.rebalance(),e}const r=new g(this);return this.children.push(r),r.content=t,r.recomputeBBox(!0),r}getBBox(){return this.bbox}recomputeBBox(t){var e,n,r;const i=this.bbox;if(null!==this.content)this.bbox=this.content.getBBox(),this.minZIndex=this.content.zIndex,this.maxZIndex=this.content.zIndex;else{this.bbox=s.empty,this.minZIndex=null,this.maxZIndex=null;let t=!0;for(const r of this.children)t?(this.bbox=r.getBBox(),t=!1):this.bbox=this.bbox.union(r.getBBox()),null!==(e=this.minZIndex)&&void 0!==e||(this.minZIndex=r.minZIndex),null!==(n=this.maxZIndex)&&void 0!==n||(this.maxZIndex=r.maxZIndex),null!==r.minZIndex&&null!==this.minZIndex&&(this.minZIndex=Math.min(r.minZIndex,this.minZIndex)),null!==r.maxZIndex&&null!==this.maxZIndex&&(this.maxZIndex=Math.max(r.maxZIndex,this.maxZIndex))}t&&!i.eq(this.bbox)&&(null===(r=this.parent)||void 0===r||r.recomputeBBox(!0))}rebalance(){if(this.parent&&1===this.parent.children.length){console.assert(null===this.parent.content),console.assert(this.parent.children[0]===this);const t=this.parent;null!==t.parent?(t.children=[],this.parent=t.parent,this.parent.children.push(this),t.parent=null,this.parent.recomputeBBox(!1)):null===this.content&&(this.parent.children=this.children,this.parent=null)}}remove(){if(this.minZIndex=null,this.maxZIndex=null,!this.parent)return this.content=null,void(this.children=[]);const t=this.parent.children.length;this.parent.children=this.parent.children.filter((t=>t!==this)),console.assert(this.parent.children.length===t-1),this.parent.children.forEach((t=>{t.rebalance()})),this.parent.recomputeBBox(!0),this.content=null,this.parent=null,this.children=[]}}!function(t){t[t.PointerDownEvt=0]="PointerDownEvt",t[t.PointerMoveEvt=1]="PointerMoveEvt",t[t.PointerUpEvt=2]="PointerUpEvt",t[t.GestureCancelEvt=3]="GestureCancelEvt",t[t.WheelEvt=4]="WheelEvt",t[t.KeyPressEvent=5]="KeyPressEvent"}(h||(h={})),function(t){t[t.ToolEnabled=0]="ToolEnabled",t[t.ToolDisabled=1]="ToolDisabled",t[t.ToolUpdated=2]="ToolUpdated",t[t.UndoRedoStackUpdated=3]="UndoRedoStackUpdated",t[t.ObjectAdded=4]="ObjectAdded",t[t.ViewportChanged=5]="ViewportChanged",t[t.DisplayResized=6]="DisplayResized",t[t.ColorPickerToggled=7]="ColorPickerToggled"}(d||(d={}));class v{constructor(t,n,r,i,o,s,a,l,c){this.a1=t,this.a2=n,this.a3=r,this.b1=i,this.b2=o,this.b3=s,this.c1=a,this.c2=l,this.c3=c,this.cachedInverse=void 0,this.rows=[e.of(t,n,r),e.of(i,o,s),e.of(a,l,c)]}static ofRows(t,e,n){return new v(t.x,t.y,t.z,e.x,e.y,e.z,n.x,n.y,n.z)}inverse(){var t;return null!==(t=this.computeInverse())&&void 0!==t?t:v.identity}invertable(){return null!==this.computeInverse()}computeInverse(){if(void 0!==this.cachedInverse)return this.cachedInverse;const t=[this.rows[0],this.rows[1],this.rows[2]],n=[e.unitX,e.unitY,e.unitZ];for(let e=0;e<3;e++){let r=t[e].at(e);const i=1e-10;if(Math.abs(r)<i){let o=-1;for(let n=1;n<=2;n++){const r=(e+n)%3;if(Math.abs(t[r].at(e))>=i){o=r;break}}if(-1===o)return this.cachedInverse=null,null;const s=t[e],a=n[e];t[e]=t[o],n[e]=n[o],t[o]=s,n[o]=a,r=t[e].at(e)}let o=1/r;t[e]=t[e].times(o),n[e]=n[e].times(o);const s=t[e],a=n[e];for(let r=1;r<=2;r++){const i=(e+r)%3;o=-t[i].at(e),t[i]=t[i].plus(s.times(o)),n[i]=n[i].plus(a.times(o))}}const r=v.ofRows(n[0],n[1],n[2]);return this.cachedInverse=r,r}transposed(){return new v(this.a1,this.b1,this.c1,this.a2,this.b2,this.c2,this.a3,this.b3,this.c3)}rightMul(t){t=t.transposed();const e=(e,n)=>this.rows[e].dot(t.rows[n]);return new v(e(0,0),e(0,1),e(0,2),e(1,0),e(1,1),e(1,2),e(2,0),e(2,1),e(2,2))}transformVec2(t){let r=e.of(t.x,t.y,1);return r=this.transformVec3(r),n.of(r.x,r.y)}transformVec3(t){return e.of(this.rows[0].dot(t),this.rows[1].dot(t),this.rows[2].dot(t))}eq(t,e=0){for(let n=0;n<3;n++)if(!this.rows[n].eq(t.rows[n],e))return!1;return!0}toString(){return`\n⎡ ${this.a1},\t ${this.a2},\t ${this.a3}\t ⎤\n⎢ ${this.b1},\t ${this.b2},\t ${this.b3}\t ⎥\n⎣ ${this.c1},\t ${this.c2},\t ${this.c3}\t ⎦\n\t\t`.trimRight()}toArray(){return[this.a1,this.a2,this.a3,this.b1,this.b2,this.b3,this.c1,this.c2,this.c3]}static translation(t){return new v(1,0,t.x,0,1,t.y,0,0,1)}static zRotation(t,e=n.zero){const r=Math.cos(t),i=Math.sin(t);let o=v.translation(e);return o=o.rightMul(new v(r,-i,0,i,r,0,0,0,1)),o.rightMul(v.translation(e.times(-1)))}static scaling2D(t,e=n.zero){let r,i,o=v.translation(e);return"number"==typeof t?(r=t,i=t):(r=t.x,i=t.y),o=o.rightMul(new v(r,0,0,0,i,0,0,0,1)),o.rightMul(v.translation(e.times(-1)))}}v.identity=new v(1,0,0,0,1,0,0,0,1),function(t){t[t.Pen=0]="Pen",t[t.Eraser=1]="Eraser",t[t.Touch=2]="Touch",t[t.Mouse=3]="Mouse",t[t.Other=4]="Other"}(u||(u={}));class x{constructor(t,e,n,r,i,o,s,a){this.screenPos=t,this.canvasPos=e,this.pressure=n,this.isPrimary=r,this.down=i,this.device=o,this.id=s,this.timeStamp=a}static ofEvent(t,e,r){var i,o;const s=n.of(t.offsetX,t.offsetY);let a=null!==(i={mouse:u.Mouse,pen:u.Pen,touch:u.Touch}[t.pointerType])&&void 0!==i?i:u.Other;a===u.Pen&&0!=(32&t.buttons)&&(a=u.Eraser);const l=(new Date).getTime(),c=r.roundPoint(r.screenToCanvas(s));return new x(s,c,null!==(o=t.pressure)&&void 0!==o?o:null,t.isPrimary,e,a,t.pointerId,l)}static ofCanvasPoint(t,e,n,r=0,i=u.Pen,o=!0,s=null){const a=n.canvasToScreen(t),l=(new Date).getTime();return new x(a,t,s,o,e,i,r,l)}}var b,y,w=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n},k=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)};class P{constructor(t){this.notifier=t,this.resetTransform(v.identity),this.screenRect=s.empty}updateScreenSize(t){this.screenRect=this.screenRect.resizedTo(t)}get visibleRect(){return this.screenRect.transformedBoundingBox(this.inverseTransform)}screenToCanvas(t){return this.inverseTransform.transformVec2(t)}canvasToScreen(t){return this.transform.transformVec2(t)}resetTransform(t){this.transform=t,this.inverseTransform=t.inverse(),this.notifier.dispatch(d.ViewportChanged,{kind:d.ViewportChanged,newTransform:t})}get screenToCanvasTransform(){return this.inverseTransform}get canvasToScreenTransform(){return this.transform}getScaleFactor(){return this.transform.transformVec3(e.unitX).magnitude()}getRotationAngle(){return this.transform.transformVec3(e.unitX).angle()}static roundPoint(t,e){const n=Math.pow(10,Math.floor(Math.log10(e))),r=t=>Math.round(t/n)*n;return"number"==typeof t?r(t):t.map(r)}roundPoint(t){return P.roundPoint(t,1/this.getScaleFactor())}}P.ViewportTransform=(y=class{constructor(t){this.transform=t,b.set(this,void 0),w(this,b,t.inverse(),"f")}apply(t){const e=t.viewport;e.resetTransform(e.transform.rightMul(this.transform)),t.queueRerender()}unapply(t){const e=t.viewport;e.resetTransform(e.transform.rightMul(k(this,b,"f"))),t.queueRerender()}description(t){const e=[],r=n.unitX,i=this.transform.transformVec3(n.unitX),o=this.transform.transformVec2(n.unitX),s=i.magnitude(),a=180/Math.PI*i.angle(),l=o.minus(r);s>1.2?e.push(t.zoomedIn):s<.8&&e.push(t.zoomedOut),Math.floor(Math.abs(a))>0&&e.push(t.rotatedBy(Math.round(a)));const c=1e-4;return l.x>c?e.push(t.movedLeft):l.x<-1e-4&&e.push(t.movedRight),l.y<c?e.push(t.movedDown):l.y>c&&e.push(t.movedUp),e.join("; ")}},b=new WeakMap,y);const T=P;class C{constructor(t,e){this.notifier=t,this.description=e,this.enabled=!0,this.group=null}onWheel(t){return!1}onKeyPress(t){return!1}setEnabled(t){var e;this.enabled=t,t?(null===(e=this.group)||void 0===e||e.notifyEnabled(this),this.notifier.dispatch(d.ToolEnabled,{kind:d.ToolEnabled,tool:this})):this.notifier.dispatch(d.ToolDisabled,{kind:d.ToolDisabled,tool:this})}isEnabled(){return this.enabled}setToolGroup(t){this.isEnabled()&&t.notifyEnabled(this),this.group=t}}var E;!function(t){t[t.OneFingerGestures=1]="OneFingerGestures",t[t.TwoFingerGestures=2]="TwoFingerGestures",t[t.AnyDevice=4]="AnyDevice"}(E||(E={}));class S extends C{constructor(t,e,n){super(t.notifier,n),this.editor=t,this.mode=e,this.kind=mt.PanZoom,this.transform=null,e===E.OneFingerGestures&&(this.kind=mt.TouchPanZoom)}computePinchData(t,e){const n=e.screenPos.minus(t.screenPos),r=n.angle(),i=n.magnitude();return{canvasCenter:e.canvasPos.plus(t.canvasPos).times(.5),screenCenter:e.screenPos.plus(t.screenPos).times(.5),angle:r,dist:i}}pointersHaveCorrectDeviceType(t){return this.mode&E.AnyDevice||t.every((t=>t.device===u.Touch))}onPointerDown({allPointers:t}){var e;let n=!1;if(this.pointersHaveCorrectDeviceType(t))if(2===t.length&&this.mode&E.TwoFingerGestures){const{screenCenter:e,angle:r,dist:i}=this.computePinchData(t[0],t[1]);this.lastAngle=r,this.lastDist=i,this.lastScreenCenter=e,n=!0}else 1===t.length&&this.mode&E.OneFingerGestures&&(this.lastScreenCenter=t[0].screenPos,n=!0);else n=!1;return n&&(null!==(e=this.transform)&&void 0!==e||(this.transform=new P.ViewportTransform(v.identity))),n}getCenterDelta(t){return this.editor.viewport.screenToCanvasTransform.transformVec3(t.minus(this.lastScreenCenter))}handleTwoFingerMove(t){const{screenCenter:e,canvasCenter:n,angle:r,dist:i}=this.computePinchData(t[0],t[1]),o=this.getCenterDelta(e),s=v.translation(o).rightMul(v.scaling2D(i/this.lastDist,n)).rightMul(v.zRotation(r-this.lastAngle,n));this.lastScreenCenter=e,this.lastDist=i,this.lastAngle=r,this.transform=new P.ViewportTransform(this.transform.transform.rightMul(s))}handleOneFingerMove(t){const e=this.getCenterDelta(t.screenPos);this.transform=new P.ViewportTransform(this.transform.transform.rightMul(v.translation(e))),this.lastScreenCenter=t.screenPos}onPointerMove({allPointers:t}){var e;null!==(e=this.transform)&&void 0!==e||(this.transform=new P.ViewportTransform(v.identity));const n=this.transform;2===t.length&&this.mode&E.TwoFingerGestures?this.handleTwoFingerMove(t):1===t.length&&this.mode&E.OneFingerGestures&&this.handleOneFingerMove(t[0]),n.unapply(this.editor),this.transform.apply(this.editor)}onPointerUp(t){this.transform&&(this.transform.unapply(this.editor),this.editor.dispatch(this.transform,!1)),this.transform=null}onGestureCancel(){var t;null===(t=this.transform)||void 0===t||t.unapply(this.editor),this.transform=null}updateTransform(t){var e;let n=t;this.transform&&(n=this.transform.transform.rightMul(t)),null===(e=this.transform)||void 0===e||e.unapply(this.editor),this.transform=new P.ViewportTransform(n),this.transform.apply(this.editor)}onWheel({delta:t,screenPos:n}){null===this.transform&&(this.transform=new P.ViewportTransform(v.identity));const r=this.editor.viewport.screenToCanvas(n),i=this.editor.viewport.screenToCanvasTransform.transformVec3(e.of(-t.x,-t.y,0)),o=v.scaling2D(Math.pow(1.04,-t.z),r).rightMul(v.translation(i));return this.updateTransform(o),!0}onKeyPress({key:t}){let e=n.zero,r=1,i=0;switch(t){case"a":case"h":case"ArrowLeft":e=n.of(-1,0);break;case"d":case"l":case"ArrowRight":e=n.of(1,0);break;case"k":case"ArrowUp":e=n.of(0,-1);break;case"j":case"ArrowDown":e=n.of(0,1);break;case"w":r=.5;break;case"s":r=2;break;case"r":i=1;break;case"R":i=-1;break;default:return!1}e=e.times(30),i*=Math.PI/8,e=e.times(-1),i*=-1,r=1/r;e=this.editor.viewport.screenToCanvasTransform.transformVec3(e);const o=this.editor.viewport.visibleRect.center,s=v.scaling2D(r,o).rightMul(v.zRotation(i,o)).rightMul(v.translation(e));return this.updateTransform(s),!0}}const{abs:z,cos:B,sin:L,acos:R,atan2:M,sqrt:A,pow:I}=Math;function D(t){return t<0?-I(-t,1/3):I(t,1/3)}const O=Math.PI,j=2*O,N=O/2,V=Number.MAX_SAFE_INTEGER||9007199254740991,F=Number.MIN_SAFE_INTEGER||-9007199254740991,$={x:0,y:0,z:0},U={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){const n=e(t);let r=n.x*n.x+n.y*n.y;return void 0!==n.z&&(r+=n.z*n.z),A(r)},compute:function(t,e,n){if(0===t)return e[0].t=0,e[0];const r=e.length-1;if(1===t)return e[r].t=1,e[r];const i=1-t;let o=e;if(0===r)return e[0].t=t,e[0];if(1===r){const e={x:i*o[0].x+t*o[1].x,y:i*o[0].y+t*o[1].y,t};return n&&(e.z=i*o[0].z+t*o[1].z),e}if(r<4){let e,s,a,l=i*i,c=t*t,h=0;2===r?(o=[o[0],o[1],o[2],$],e=l,s=i*t*2,a=c):3===r&&(e=l*i,s=l*t*3,a=i*c*3,h=t*c);const d={x:e*o[0].x+s*o[1].x+a*o[2].x+h*o[3].x,y:e*o[0].y+s*o[1].y+a*o[2].y+h*o[3].y,t};return n&&(d.z=e*o[0].z+s*o[1].z+a*o[2].z+h*o[3].z),d}const s=JSON.parse(JSON.stringify(e));for(;s.length>1;){for(let e=0;e<s.length-1;e++)s[e]={x:s[e].x+(s[e+1].x-s[e].x)*t,y:s[e].y+(s[e+1].y-s[e].y)*t},void 0!==s[e].z&&(s[e]=s[e].z+(s[e+1].z-s[e].z)*t);s.splice(s.length-1,1)}return s[0].t=t,s[0]},computeWithRatios:function(t,e,n,r){const i=1-t,o=n,s=e;let a,l=o[0],c=o[1],h=o[2],d=o[3];return l*=i,c*=t,2===s.length?(a=l+c,{x:(l*s[0].x+c*s[1].x)/a,y:(l*s[0].y+c*s[1].y)/a,z:!!r&&(l*s[0].z+c*s[1].z)/a,t}):(l*=i,c*=2*i,h*=t*t,3===s.length?(a=l+c+h,{x:(l*s[0].x+c*s[1].x+h*s[2].x)/a,y:(l*s[0].y+c*s[1].y+h*s[2].y)/a,z:!!r&&(l*s[0].z+c*s[1].z+h*s[2].z)/a,t}):(l*=i,c*=1.5*i,h*=3*i,d*=t*t*t,4===s.length?(a=l+c+h+d,{x:(l*s[0].x+c*s[1].x+h*s[2].x+d*s[3].x)/a,y:(l*s[0].y+c*s[1].y+h*s[2].y+d*s[3].y)/a,z:!!r&&(l*s[0].z+c*s[1].z+h*s[2].z+d*s[3].z)/a,t}):void 0))},derive:function(t,e){const n=[];for(let r=t,i=r.length,o=i-1;i>1;i--,o--){const t=[];for(let n,i=0;i<o;i++)n={x:o*(r[i+1].x-r[i].x),y:o*(r[i+1].y-r[i].y)},e&&(n.z=o*(r[i+1].z-r[i].z)),t.push(n);n.push(t),r=t}return n},between:function(t,e,n){return e<=t&&t<=n||U.approximately(t,e)||U.approximately(t,n)},approximately:function(t,e,n){return z(t-e)<=(n||1e-6)},length:function(t){const e=U.Tvalues.length;let n=0;for(let r,i=0;i<e;i++)r=.5*U.Tvalues[i]+.5,n+=U.Cvalues[i]*U.arcfn(r,t);return.5*n},map:function(t,e,n,r,i){return r+(i-r)*((t-e)/(n-e))},lerp:function(t,e,n){const r={x:e.x+t*(n.x-e.x),y:e.y+t*(n.y-e.y)};return void 0!==e.z&&void 0!==n.z&&(r.z=e.z+t*(n.z-e.z)),r},pointToString:function(t){let e=t.x+"/"+t.y;return void 0!==t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map(U.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,n){const r=e.x-t.x,i=e.y-t.y,o=n.x-t.x,s=n.y-t.y;return M(r*s-i*o,r*o+i*s)},round:function(t,e){const n=""+t,r=n.indexOf(".");return parseFloat(n.substring(0,r+1+e))},dist:function(t,e){const n=t.x-e.x,r=t.y-e.y;return A(n*n+r*r)},closest:function(t,e){let n,r,i=I(2,63);return t.forEach((function(t,o){r=U.dist(e,t),r<i&&(i=r,n=o)})),{mdist:i,mpos:n}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const n=I(t,e)+I(1-t,e);return z((n-1)/n)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;const n=I(1-t,e);return n/(I(t,e)+n)},lli8:function(t,e,n,r,i,o,s,a){const l=(t-n)*(o-a)-(e-r)*(i-s);return 0!=l&&{x:((t*r-e*n)*(i-s)-(t-n)*(i*a-o*s))/l,y:((t*r-e*n)*(o-a)-(e-r)*(i*a-o*s))/l}},lli4:function(t,e,n,r){const i=t.x,o=t.y,s=e.x,a=e.y,l=n.x,c=n.y,h=r.x,d=r.y;return U.lli8(i,o,s,a,l,c,h,d)},lli:function(t,e){return U.lli4(t,t.c,e,e.c)},makeline:function(t,e){return new K(t.x,t.y,(t.x+e.x)/2,(t.y+e.y)/2,e.x,e.y)},findbbox:function(t){let e=V,n=V,r=F,i=F;return t.forEach((function(t){const o=t.bbox();e>o.x.min&&(e=o.x.min),n>o.y.min&&(n=o.y.min),r<o.x.max&&(r=o.x.max),i<o.y.max&&(i=o.y.max)})),{x:{min:e,mid:(e+r)/2,max:r,size:r-e},y:{min:n,mid:(n+i)/2,max:i,size:i-n}}},shapeintersections:function(t,e,n,r,i){if(!U.bboxoverlap(e,r))return[];const o=[],s=[t.startcap,t.forward,t.back,t.endcap],a=[n.startcap,n.forward,n.back,n.endcap];return s.forEach((function(e){e.virtual||a.forEach((function(r){if(r.virtual)return;const s=e.intersects(r,i);s.length>0&&(s.c1=e,s.c2=r,s.s1=t,s.s2=n,o.push(s))}))})),o},makeshape:function(t,e,n){const r=e.points.length,i=t.points.length,o=U.makeline(e.points[r-1],t.points[0]),s=U.makeline(t.points[i-1],e.points[0]),a={startcap:o,forward:t,back:e,endcap:s,bbox:U.findbbox([o,t,e,s]),intersections:function(t){return U.shapeintersections(a,a.bbox,t,t.bbox,n)}};return a},getminmax:function(t,e,n){if(!n)return{min:0,max:0};let r,i,o=V,s=F;-1===n.indexOf(0)&&(n=[0].concat(n)),-1===n.indexOf(1)&&n.push(1);for(let a=0,l=n.length;a<l;a++)r=n[a],i=t.get(r),i[e]<o&&(o=i[e]),i[e]>s&&(s=i[e]);return{min:o,mid:(o+s)/2,max:s,size:s-o}},align:function(t,e){const n=e.p1.x,r=e.p1.y,i=-M(e.p2.y-r,e.p2.x-n);return t.map((function(t){return{x:(t.x-n)*B(i)-(t.y-r)*L(i),y:(t.x-n)*L(i)+(t.y-r)*B(i)}}))},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const n=t.length-1,r=U.align(t,e),i=function(t){return 0<=t&&t<=1};if(2===n){const t=r[0].y,e=r[1].y,n=r[2].y,o=t-2*e+n;if(0!==o){const r=-A(e*e-t*n),s=-t+e;return[-(r+s)/o,-(-r+s)/o].filter(i)}return e!==n&&0===o?[(2*e-n)/(2*e-2*n)].filter(i):[]}const o=r[0].y,s=r[1].y,a=r[2].y;let l=3*s-o-3*a+r[3].y,c=3*o-6*s+3*a,h=-3*o+3*s,d=o;if(U.approximately(l,0)){if(U.approximately(c,0))return U.approximately(h,0)?[]:[-d/h].filter(i);const t=A(h*h-4*c*d),e=2*c;return[(t-h)/e,(-h-t)/e].filter(i)}c/=l,h/=l,d/=l;const u=(3*h-c*c)/3,p=u/3,f=(2*c*c*c-9*c*h+27*d)/27,m=f/2,g=m*m+p*p*p;let v,x,b,y,w;if(g<0){const t=-u/3,e=A(t*t*t),n=-f/(2*e),r=R(n<-1?-1:n>1?1:n),o=2*D(e);return b=o*B(r/3)-c/3,y=o*B((r+j)/3)-c/3,w=o*B((r+2*j)/3)-c/3,[b,y,w].filter(i)}if(0===g)return v=m<0?D(-m):-D(m),b=2*v-c/3,y=-v-c/3,[b,y].filter(i);{const t=A(g);return v=D(-m+t),x=D(m+t),[v-x-c/3].filter(i)}},droots:function(t){if(3===t.length){const e=t[0],n=t[1],r=t[2],i=e-2*n+r;if(0!==i){const t=-A(n*n-e*r),o=-e+n;return[-(t+o)/i,-(-t+o)/i]}return n!==r&&0===i?[(2*n-r)/(2*(n-r))]:[]}if(2===t.length){const e=t[0],n=t[1];return e!==n?[e/(e-n)]:[]}return[]},curvature:function(t,e,n,r,i){let o,s,a,l,c=0,h=0;const d=U.compute(t,e),u=U.compute(t,n),p=d.x*d.x+d.y*d.y;if(r?(o=A(I(d.y*u.z-u.y*d.z,2)+I(d.z*u.x-u.z*d.x,2)+I(d.x*u.y-u.x*d.y,2)),s=I(p+d.z*d.z,1.5)):(o=d.x*u.y-d.y*u.x,s=I(p,1.5)),0===o||0===s)return{k:0,r:0};if(c=o/s,h=s/o,!i){const i=U.curvature(t-.001,e,n,r,!0).k,o=U.curvature(t+.001,e,n,r,!0).k;l=(o-c+(c-i))/2,a=(z(o-c)+z(c-i))/2}return{k:c,r:h,dk:l,adk:a}},inflections:function(t){if(t.length<4)return[];const e=U.align(t,{p1:t[0],p2:t.slice(-1)[0]}),n=e[2].x*e[1].y,r=e[3].x*e[1].y,i=e[1].x*e[2].y,o=18*(-3*n+2*r+3*i-e[3].x*e[2].y),s=18*(3*n-r-3*i),a=18*(i-n);if(U.approximately(o,0)){if(!U.approximately(s,0)){let t=-a/s;if(0<=t&&t<=1)return[t]}return[]}const l=2*o;if(U.approximately(l,0))return[];const c=s*s-4*o*a;if(c<0)return[];const h=Math.sqrt(c);return[(h-s)/l,-(s+h)/l].filter((function(t){return 0<=t&&t<=1}))},bboxoverlap:function(t,e){const n=["x","y"],r=n.length;for(let i,o,s,a,l=0;l<r;l++)if(i=n[l],o=t[i].mid,s=e[i].mid,a=(t[i].size+e[i].size)/2,z(o-s)>=a)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,n){const r=t.bbox(),i=e.bbox(),o=1e5,s=n||.5;if(r.x.size+r.y.size<s&&i.x.size+i.y.size<s)return[(o*(t._t1+t._t2)/2|0)/o+"/"+(o*(e._t1+e._t2)/2|0)/o];let a=t.split(.5),l=e.split(.5),c=[{left:a.left,right:l.left},{left:a.left,right:l.right},{left:a.right,right:l.right},{left:a.right,right:l.left}];c=c.filter((function(t){return U.bboxoverlap(t.left.bbox(),t.right.bbox())}));let h=[];return 0===c.length||(c.forEach((function(t){h=h.concat(U.pairiteration(t.left,t.right,s))})),h=h.filter((function(t,e){return h.indexOf(t)===e}))),h},getccenter:function(t,e,n){const r=e.x-t.x,i=e.y-t.y,o=n.x-e.x,s=n.y-e.y,a=r*B(N)-i*L(N),l=r*L(N)+i*B(N),c=o*B(N)-s*L(N),h=o*L(N)+s*B(N),d=(t.x+e.x)/2,u=(t.y+e.y)/2,p=(e.x+n.x)/2,f=(e.y+n.y)/2,m=d+a,g=u+l,v=p+c,x=f+h,b=U.lli8(d,u,m,g,p,f,v,x),y=U.dist(b,t);let w,k=M(t.y-b.y,t.x-b.x),P=M(e.y-b.y,e.x-b.x),T=M(n.y-b.y,n.x-b.x);return k<T?((k>P||P>T)&&(k+=j),k>T&&(w=T,T=k,k=w)):T<P&&P<k?(w=T,T=k,k=w):T+=j,b.s=k,b.e=T,b.r=y,b},numberSort:function(t,e){return t-e}};class _{constructor(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map((function(t){return U.pointsToString(t.points)})).join(", ")+"]"}addCurve(t){this.curves.push(t),this._3d=this._3d||t._3d}length(){return this.curves.map((function(t){return t.length()})).reduce((function(t,e){return t+e}))}curve(t){return this.curves[t]}bbox(){const t=this.curves;for(var e=t[0].bbox(),n=1;n<t.length;n++)U.expandbox(e,t[n].bbox());return e}offset(t){const e=[];return this.curves.forEach((function(n){e.push(...n.offset(t))})),new _(e)}}const{abs:W,min:G,max:H,cos:Z,sin:q,acos:X,sqrt:Y}=Math,Q=Math.PI;class K{constructor(t){let e=t&&t.forEach?t:Array.from(arguments).slice(),n=!1;if("object"==typeof e[0]){n=e.length;const t=[];e.forEach((function(e){["x","y","z"].forEach((function(n){void 0!==e[n]&&t.push(e[n])}))})),e=t}let r=!1;const i=e.length;if(n){if(n>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");r=!0}}else if(6!==i&&8!==i&&9!==i&&12!==i&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const o=this._3d=!r&&(9===i||12===i)||t&&t[0]&&void 0!==t[0].z,s=this.points=[];for(let t=0,n=o?3:2;t<i;t+=n){var a={x:e[t],y:e[t+1]};o&&(a.z=e[t+2]),s.push(a)}const l=this.order=s.length-1,c=this.dims=["x","y"];o&&c.push("z"),this.dimlen=c.length;const h=U.align(s,{p1:s[0],p2:s[l]}),d=U.dist(s[0],s[l]);this._linear=h.reduce(((t,e)=>t+W(e.y)),0)<d/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(t,e,n,r){if(void 0===r&&(r=.5),0===r)return new K(e,e,n);if(1===r)return new K(t,e,e);const i=K.getABC(2,t,e,n,r);return new K(t,i.A,n)}static cubicFromPoints(t,e,n,r,i){void 0===r&&(r=.5);const o=K.getABC(3,t,e,n,r);void 0===i&&(i=U.dist(e,o.C));const s=i*(1-r)/r,a=U.dist(t,n),l=(n.x-t.x)/a,c=(n.y-t.y)/a,h=i*l,d=i*c,u=s*l,p=s*c,f=e.x-h,m=e.y-d,g=e.x+u,v=e.y+p,x=o.A,b=x.x+(f-x.x)/(1-r),y=x.y+(m-x.y)/(1-r),w=x.x+(g-x.x)/r,k=x.y+(v-x.y)/r,P={x:t.x+(b-t.x)/r,y:t.y+(y-t.y)/r},T={x:n.x+(w-n.x)/(1-r),y:n.y+(k-n.y)/(1-r)};return new K(t,P,T,n)}static getUtils(){return U}getUtils(){return K.getUtils()}static get PolyBezier(){return _}valueOf(){return this.toString()}toString(){return U.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const t=this.points,e=["M",t[0].x,t[0].y,2===this.order?"Q":"C"];for(let n=1,r=t.length;n<r;n++)e.push(t[n].x),e.push(t[n].y);return e.join(" ")}setRatios(t){if(t.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=t,this._lut=[]}verify(){const t=this.coordDigest();t!==this._print&&(this._print=t,this.update())}coordDigest(){return this.points.map((function(t,e){return""+e+t.x+t.y+(t.z?t.z:0)})).join("")}update(){this._lut=[],this.dpoints=U.derive(this.points,this._3d),this.computedirection()}computedirection(){const t=this.points,e=U.angle(t[0],t[this.order],t[1]);this.clockwise=e>0}length(){return U.length(this.derivative.bind(this))}static getABC(t=2,e,n,r,i=.5){const o=U.projectionratio(i,t),s=1-o,a={x:o*e.x+s*r.x,y:o*e.y+s*r.y},l=U.abcratio(i,t);return{A:{x:n.x+(n.x-a.x)/l,y:n.y+(n.y-a.y)/l},B:n,C:a,S:e,E:r}}getABC(t,e){e=e||this.get(t);let n=this.points[0],r=this.points[this.order];return K.getABC(this.order,n,e,r,t)}getLUT(t){if(this.verify(),t=t||100,this._lut.length===t)return this._lut;this._lut=[],t++,this._lut=[];for(let e,n,r=0;r<t;r++)n=r/(t-1),e=this.compute(n),e.t=n,this._lut.push(e);return this._lut}on(e,n){n=n||5;const r=this.getLUT(),i=[];for(let t,o=0,s=0;o<r.length;o++)t=r[o],U.dist(t,e)<n&&(i.push(t),s+=o/r.length);return!!i.length&&(t/=i.length)}project(t){const e=this.getLUT(),n=e.length-1,r=U.closest(e,t),i=r.mpos,o=(i-1)/n,s=(i+1)/n,a=.1/n;let l,c,h=r.mdist,d=o,u=d;for(h+=1;d<s+a;d+=a)l=this.compute(d),c=U.dist(t,l),c<h&&(h=c,u=d);return u=u<0?0:u>1?1:u,l=this.compute(u),l.t=u,l.d=h,l}get(t){return this.compute(t)}point(t){return this.points[t]}compute(t){return this.ratios?U.computeWithRatios(t,this.points,this.ratios,this._3d):U.compute(t,this.points,this._3d,this.ratios)}raise(){const t=this.points,e=[t[0]],n=t.length;for(let r,i,o=1;o<n;o++)r=t[o],i=t[o-1],e[o]={x:(n-o)/n*r.x+o/n*i.x,y:(n-o)/n*r.y+o/n*i.y};return e[n]=t[n-1],new K(e)}derivative(t){return U.compute(t,this.dpoints[0],this._3d)}dderivative(t){return U.compute(t,this.dpoints[1],this._3d)}align(){let t=this.points;return new K(U.align(t,{p1:t[0],p2:t[t.length-1]}))}curvature(t){return U.curvature(t,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return U.inflections(this.points)}normal(t){return this._3d?this.__normal3(t):this.__normal2(t)}__normal2(t){const e=this.derivative(t),n=Y(e.x*e.x+e.y*e.y);return{t,x:-e.y/n,y:e.x/n}}__normal3(t){const e=this.derivative(t),n=this.derivative(t+.01),r=Y(e.x*e.x+e.y*e.y+e.z*e.z),i=Y(n.x*n.x+n.y*n.y+n.z*n.z);e.x/=r,e.y/=r,e.z/=r,n.x/=i,n.y/=i,n.z/=i;const o={x:n.y*e.z-n.z*e.y,y:n.z*e.x-n.x*e.z,z:n.x*e.y-n.y*e.x},s=Y(o.x*o.x+o.y*o.y+o.z*o.z);o.x/=s,o.y/=s,o.z/=s;const a=[o.x*o.x,o.x*o.y-o.z,o.x*o.z+o.y,o.x*o.y+o.z,o.y*o.y,o.y*o.z-o.x,o.x*o.z-o.y,o.y*o.z+o.x,o.z*o.z];return{t,x:a[0]*e.x+a[1]*e.y+a[2]*e.z,y:a[3]*e.x+a[4]*e.y+a[5]*e.z,z:a[6]*e.x+a[7]*e.y+a[8]*e.z}}hull(t){let e=this.points,n=[],r=[],i=0;for(r[i++]=e[0],r[i++]=e[1],r[i++]=e[2],3===this.order&&(r[i++]=e[3]);e.length>1;){n=[];for(let o,s=0,a=e.length-1;s<a;s++)o=U.lerp(t,e[s],e[s+1]),r[i++]=o,n.push(o);e=n}return r}split(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;const n=this.hull(t),r={left:2===this.order?new K([n[0],n[3],n[5]]):new K([n[0],n[4],n[7],n[9]]),right:2===this.order?new K([n[5],n[4],n[2]]):new K([n[9],n[8],n[6],n[3]]),span:n};return r.left._t1=U.map(0,0,1,this._t1,this._t2),r.left._t2=U.map(t,0,1,this._t1,this._t2),r.right._t1=U.map(t,0,1,this._t1,this._t2),r.right._t2=U.map(1,0,1,this._t1,this._t2),e?(e=U.map(e,t,1,0,1),r.right.split(e).left):r}extrema(){const t={};let e=[];return this.dims.forEach(function(n){let r=function(t){return t[n]},i=this.dpoints[0].map(r);t[n]=U.droots(i),3===this.order&&(i=this.dpoints[1].map(r),t[n]=t[n].concat(U.droots(i))),t[n]=t[n].filter((function(t){return t>=0&&t<=1})),e=e.concat(t[n].sort(U.numberSort))}.bind(this)),t.values=e.sort(U.numberSort).filter((function(t,n){return e.indexOf(t)===n})),t}bbox(){const t=this.extrema(),e={};return this.dims.forEach(function(n){e[n]=U.getminmax(this,n,t[n])}.bind(this)),e}overlaps(t){const e=this.bbox(),n=t.bbox();return U.bboxoverlap(e,n)}offset(t,e){if(void 0!==e){const n=this.get(t),r=this.normal(t),i={c:n,n:r,x:n.x+r.x*e,y:n.y+r.y*e};return this._3d&&(i.z=n.z+r.z*e),i}if(this._linear){const e=this.normal(0),n=this.points.map((function(n){const r={x:n.x+t*e.x,y:n.y+t*e.y};return n.z&&e.z&&(r.z=n.z+t*e.z),r}));return[new K(n)]}return this.reduce().map((function(e){return e._linear?e.offset(t)[0]:e.scale(t)}))}simple(){if(3===this.order){const t=U.angle(this.points[0],this.points[3],this.points[1]),e=U.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&e<0||t<0&&e>0)return!1}const t=this.normal(0),e=this.normal(1);let n=t.x*e.x+t.y*e.y;return this._3d&&(n+=t.z*e.z),W(X(n))<Q/3}reduce(){let t,e,n=0,r=0,i=.01,o=[],s=[],a=this.extrema().values;for(-1===a.indexOf(0)&&(a=[0].concat(a)),-1===a.indexOf(1)&&a.push(1),n=a[0],t=1;t<a.length;t++)r=a[t],e=this.split(n,r),e._t1=n,e._t2=r,o.push(e),n=r;return o.forEach((function(t){for(n=0,r=0;r<=1;)for(r=n+i;r<=1.01;r+=i)if(e=t.split(n,r),!e.simple()){if(r-=i,W(n-r)<i)return[];e=t.split(n,r),e._t1=U.map(n,0,1,t._t1,t._t2),e._t2=U.map(r,0,1,t._t1,t._t2),s.push(e),n=r;break}n<1&&(e=t.split(n,1),e._t1=U.map(n,0,1,t._t1,t._t2),e._t2=t._t2,s.push(e))})),s}translate(t,e,n){n="number"==typeof n?n:e;const r=this.order;let i=this.points.map(((t,i)=>(1-i/r)*e+i/r*n));return new K(this.points.map(((e,n)=>({x:e.x+t.x*i[n],y:e.y+t.y*i[n]}))))}scale(t){const e=this.order;let n=!1;if("function"==typeof t&&(n=t),n&&2===e)return this.raise().scale(n);const r=this.clockwise,i=this.points;if(this._linear)return this.translate(this.normal(0),n?n(0):t,n?n(1):t);const o=n?n(0):t,s=n?n(1):t,a=[this.offset(0,10),this.offset(1,10)],l=[],c=U.lli4(a[0],a[0].c,a[1],a[1].c);if(!c)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach((function(t){const n=l[t*e]=U.copy(i[t*e]);n.x+=(t?s:o)*a[t].n.x,n.y+=(t?s:o)*a[t].n.y})),n?([0,1].forEach((function(o){if(2!==e||!o){var s=i[o+1],a={x:s.x-c.x,y:s.y-c.y},h=n?n((o+1)/e):t;n&&!r&&(h=-h);var d=Y(a.x*a.x+a.y*a.y);a.x/=d,a.y/=d,l[o+1]={x:s.x+h*a.x,y:s.y+h*a.y}}})),new K(l)):([0,1].forEach((t=>{if(2===e&&t)return;const n=l[t*e],r=this.derivative(t),o={x:n.x+r.x,y:n.y+r.y};l[t+1]=U.lli4(n,o,c,i[t+1])})),new K(l))}outline(t,e,n,r){if(e=void 0===e?t:e,this._linear){const i=this.normal(0),o=this.points[0],s=this.points[this.points.length-1];let a,l,c;void 0===n&&(n=t,r=e),a={x:o.x+i.x*t,y:o.y+i.y*t},c={x:s.x+i.x*n,y:s.y+i.y*n},l={x:(a.x+c.x)/2,y:(a.y+c.y)/2};const h=[a,l,c];a={x:o.x-i.x*e,y:o.y-i.y*e},c={x:s.x-i.x*r,y:s.y-i.y*r},l={x:(a.x+c.x)/2,y:(a.y+c.y)/2};const d=[c,l,a],u=U.makeline(d[2],h[0]),p=U.makeline(h[2],d[0]),f=[u,new K(h),p,new K(d)];return new _(f)}const i=this.reduce(),o=i.length,s=[];let a,l=[],c=0,h=this.length();const d=void 0!==n&&void 0!==r;function u(t,e,n,r,i){return function(o){const s=r/n,a=(r+i)/n,l=e-t;return U.map(o,0,1,t+s*l,t+a*l)}}i.forEach((function(i){const o=i.length();d?(s.push(i.scale(u(t,n,h,c,o))),l.push(i.scale(u(-e,-r,h,c,o)))):(s.push(i.scale(t)),l.push(i.scale(-e))),c+=o})),l=l.map((function(t){return a=t.points,a[3]?t.points=[a[3],a[2],a[1],a[0]]:t.points=[a[2],a[1],a[0]],t})).reverse();const p=s[0].points[0],f=s[o-1].points[s[o-1].points.length-1],m=l[o-1].points[l[o-1].points.length-1],g=l[0].points[0],v=U.makeline(m,p),x=U.makeline(f,g),b=[v].concat(s).concat([x]).concat(l);return new _(b)}outlineshapes(t,e,n){e=e||t;const r=this.outline(t,e).curves,i=[];for(let t=1,e=r.length;t<e/2;t++){const o=U.makeshape(r[t],r[e-t],n);o.startcap.virtual=t>1,o.endcap.virtual=t<e/2-1,i.push(o)}return i}intersects(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof K&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)}lineIntersects(t){const e=G(t.p1.x,t.p2.x),n=G(t.p1.y,t.p2.y),r=H(t.p1.x,t.p2.x),i=H(t.p1.y,t.p2.y);return U.roots(this.points,t).filter((t=>{var o=this.get(t);return U.between(o.x,e,r)&&U.between(o.y,n,i)}))}selfintersects(t){const e=this.reduce(),n=e.length-2,r=[];for(let i,o,s,a=0;a<n;a++)o=e.slice(a,a+1),s=e.slice(a+2),i=this.curveintersects(o,s,t),r.push(...i);return r}curveintersects(t,e,n){const r=[];t.forEach((function(t){e.forEach((function(e){t.overlaps(e)&&r.push({left:t,right:e})}))}));let i=[];return r.forEach((function(t){const e=U.pairiteration(t.left,t.right,n);e.length>0&&(i=i.concat(e))})),i}arcs(t){return t=t||.5,this._iterate(t,[])}_error(t,e,n,r){const i=(r-n)/4,o=this.get(n+i),s=this.get(r-i),a=U.dist(t,e),l=U.dist(t,o),c=U.dist(t,s);return W(l-a)+W(c-a)}_iterate(t,e){let n,r=0,i=1;do{n=0,i=1;let o,s,a,l,c,h=this.get(r),d=!1,u=!1,p=i,f=1,m=0;do{if(u=d,l=a,p=(r+i)/2,m++,o=this.get(p),s=this.get(i),a=U.getccenter(h,o,s),a.interval={start:r,end:i},d=this._error(a,h,r,i)<=t,c=u&&!d,c||(f=i),d){if(i>=1){if(a.interval.end=f=1,l=a,i>1){let t={x:a.x+a.r*Z(a.e),y:a.y+a.r*q(a.e)};a.e+=U.angle({x:a.x,y:a.y},t,this.get(1))}break}i+=(i-r)/2}else i=p}while(!c&&n++<100);if(n>=100)break;l=l||a,e.push(l),r=f}while(i<1);return e}}var J;!function(t){t[t.LineTo=0]="LineTo",t[t.MoveTo=1]="MoveTo",t[t.CubicBezierTo=2]="CubicBezierTo",t[t.QuadraticBezierTo=3]="QuadraticBezierTo"}(J||(J={}));class tt{constructor(t,e){this.startPoint=t,this.parts=e,this.cachedGeometry=null,this.bbox=s.bboxOf([t]);for(const n of e)this.bbox=this.bbox.union(tt.computeBBoxForSegment(t,n))}get geometry(){if(this.cachedGeometry)return this.cachedGeometry;let t=this.startPoint;const e=[];for(const n of this.parts)switch(n.kind){case J.CubicBezierTo:e.push(new K(t.xy,n.controlPoint1.xy,n.controlPoint2.xy,n.endPoint.xy)),t=n.endPoint;break;case J.QuadraticBezierTo:e.push(new K(t.xy,n.controlPoint.xy,n.endPoint.xy)),t=n.endPoint;break;case J.LineTo:e.push(new o(t,n.point)),t=n.point;break;case J.MoveTo:t=n.point}return this.cachedGeometry=e,this.cachedGeometry}static computeBBoxForSegment(t,e){const n=[t];let r;switch(e.kind){case J.MoveTo:case J.LineTo:n.push(e.point);break;case J.CubicBezierTo:n.push(e.controlPoint1,e.controlPoint2,e.endPoint);break;case J.QuadraticBezierTo:n.push(e.controlPoint,e.endPoint);break;default:return r=e,r}return s.bboxOf(n)}intersection(t){const e=[];for(const r of this.geometry)if(r instanceof o){const n=r.intersection(t);n&&e.push({curve:r,parameterValue:n.t,point:n.point})}else{const i=r.intersects(t).map((e=>{"string"==typeof e&&(e=parseFloat(e));const i=n.ofXY(r.get(e));return i.minus(t.p1).magnitude()>t.length||i.minus(t.p2).magnitude()>t.length?null:{point:i,parameterValue:e,curve:r}})).filter((t=>null!==t));e.push(...i)}return e}transformedBy(t){const e=t.transformVec2(this.startPoint),n=[];let r;for(const e of this.parts)switch(e.kind){case J.MoveTo:case J.LineTo:n.push({kind:e.kind,point:t.transformVec2(e.point)});break;case J.CubicBezierTo:n.push({kind:e.kind,controlPoint1:t.transformVec2(e.controlPoint1),controlPoint2:t.transformVec2(e.controlPoint2),endPoint:t.transformVec2(e.endPoint)});break;case J.QuadraticBezierTo:n.push({kind:e.kind,controlPoint:t.transformVec2(e.controlPoint),endPoint:t.transformVec2(e.endPoint)});break;default:return r=e,r}return new tt(e,n)}union(t){return t?new tt(this.startPoint,[...this.parts,{kind:J.MoveTo,point:t.startPoint},...t.parts]):this}static fromRect(t,e=null){const r=[];let i,o;if(null!==e){const r=n.of(e,e).times(.5),a=s.fromCorners(t.topLeft.plus(r),t.bottomRight.minus(r)),l=s.fromCorners(t.topLeft.minus(r),t.bottomRight.plus(r));i=[a.corners[3],...a.corners,...l.corners.reverse()],o=l.corners[3]}else i=t.corners.slice(1),o=t.corners[0];for(const t of i)r.push({kind:J.LineTo,point:t});return new tt(o,r)}static fromRenderable(t){return new tt(t.startPoint,t.commands)}toRenderable(t){return{startPoint:this.startPoint,style:t,commands:this.parts}}toString(){return tt.toString(this.startPoint,this.parts)}static toString(t,e){const n=[],r=t=>{let e=t.toString();if(-1===e.indexOf("."))return e;const n=/^([-]?)(\d*)\.(\d*9{4,}\d)$/.exec(e);if(n){const t=n[1],r=parseInt(e.charAt(e.length-1),10),i=parseInt(n[3],10),o=parseInt(n[2],10);let s=(i+10-r).toString(),a=0;s.length>i.toString().length&&(s=s.substring(1),a=1),e=`${t+(o+a).toString()}.${s}`}return e=e.replace(/^([-]?\d*\.?\d*[1-9.])0{4,}\d$/,"$1"),e.replace(/[.]$/,"")},i=(t,...e)=>{const i=[];for(const t of e){const e=r(t.x),n=r(t.y);i.push(`${e},${n}`)}n.push(`${t}${i.join(" ")}`)};let o;i("M",t);for(const t of e)switch(t.kind){case J.MoveTo:i("M",t.point);break;case J.LineTo:i("L",t.point);break;case J.CubicBezierTo:i("C",t.controlPoint1,t.controlPoint2,t.endPoint);break;case J.QuadraticBezierTo:i("Q",t.controlPoint,t.endPoint);break;default:return o=t,o}return n.join("")}static fromString(t){t=t.split("\n").join(" ");let e=n.zero,r=null;const i=[],o=t=>{i.push({kind:J.LineTo,point:t})},s=/([MmZzLlHhVvCcSsQqTtAa])\s*([^a-zA-Z]*)/g;let a;for(;null!==(a=s.exec(t));){const t=a[2].trim().split(/[^0-9.-]/).filter((t=>t.length>0)).map((t=>parseFloat(t))),s=a[1],f=s!==s.toLowerCase(),m=t.reduce(((t,e,r,i)=>{if(r%2!=0){const o=e,s=i[r-1];return t.concat(n.of(s,o))}return t}),[]).map((t=>f?(e=t,t):(e=e.plus(t),e)));let g;switch(s.toLowerCase()){case"m":g=1,p=m[0],i.push({kind:J.MoveTo,point:p});break;case"l":g=1,o(m[0]);break;case"z":g=0,r&&o(r);break;case"c":g=3,h=m[0],d=m[1],u=m[2],i.push({kind:J.CubicBezierTo,controlPoint1:h,controlPoint2:d,endPoint:u});break;case"q":g=2,l=m[0],c=m[1],i.push({kind:J.QuadraticBezierTo,controlPoint:l,endPoint:c});break;case"h":g=0,o(f?n.of(t[0],e.y):e.plus(n.of(t[0],0)));break;case"v":g=0,o(f?n.of(e.x,t[1]):e.plus(n.of(0,t[1])));break;default:throw new Error(`Unknown path command ${s}`)}if(m.length!==g)throw new Error(`\n\t\t\t\t\tIncorrect number of arguments: got ${JSON.stringify(m)} with a length of ${m.length} ≠ ${g}.\n\t\t\t\t`.trim());m.length>0&&(null!=r||(r=m[0]))}var l,c,h,d,u,p;return new tt(null!=r?r:n.zero,i)}}class et{constructor(){this.lastChangedTime=(new Date).getTime(),this.zIndex=et.zIndexCounter++}getBBox(){return this.contentBBox}transformBy(t){const e=(t,e)=>{const n=t.image.findParent(this);let r=!1;n&&(n.remove(),r=!0),this.applyTransformation(e),r&&new m.AddElementCommand(this).apply(t)},n=this.zIndex;return{apply:n=>{this.zIndex=et.zIndexCounter++,e(n,t),n.queueRerender()},unapply:r=>{this.zIndex=n,e(r,t.inverse()),r.queueRerender()},description:t=>t.transformedElements(1)}}}et.zIndexCounter=0;class nt extends et{constructor(t){var e;super(),this.parts=t.map((t=>{const e=tt.fromRenderable(t),n=this.bboxForPart(e.bbox,t.style);return this.contentBBox?this.contentBBox=this.contentBBox.union(n):this.contentBBox=n,{path:e,bbox:n,startPoint:e.startPoint,style:t.style,commands:e.parts}})),null!==(e=this.contentBBox)&&void 0!==e||(this.contentBBox=s.empty)}intersects(t){for(const e of this.parts)if(e.path.intersection(t).length>0)return!0;return!1}render(t,e){t.startObject(this.getBBox());for(const n of this.parts){const r=n.bbox;e&&!r.intersects(e)||t.drawPath(n)}t.endObject()}bboxForPart(t,e){return e.stroke?t.grownBy(e.stroke.width/2):t}applyTransformation(t){this.contentBBox=s.empty;let e=!0;this.parts=this.parts.map((n=>{const r=n.path.transformedBy(t),i=this.bboxForPart(r.bbox,n.style);return e?(this.contentBBox=i,e=!1):this.contentBBox=this.contentBBox.union(i),{path:r,bbox:i,startPoint:r.startPoint,commands:r.parts,style:n.style}}))}description(t){return t.stroke}}const rt=(t,e)=>{const r=e.screenToCanvasTransform,i=7*r.transformVec3(n.unitX).magnitude(),o=2*r.transformVec3(n.unitX).magnitude();return new it(t,o,i)};class it{constructor(t,e,r){this.startPoint=t,this.minFitAllowed=e,this.maxFitAllowed=r,this.currentCurve=null,this.lastPoint=this.startPoint,this.segments=[],this.buffer=[this.startPoint.pos],this.momentum=n.zero,this.currentCurve=null,this.bbox=new s(this.startPoint.pos.x,this.startPoint.pos.y,0,0)}getBBox(){return this.bbox}getRenderingStyle(){var t;return{fill:null!==(t=this.lastPoint.color)&&void 0!==t?t:null}}getPreview(){if(this.currentCurve&&this.lastPoint){const t=this.currentSegmentToPath();return this.segments.concat(t)}return this.segments}preview(t){for(const e of this.getPreview())t.drawPath(e)}build(){return this.lastPoint&&this.finalizeCurrentCurve(),new nt(this.segments)}roundPoint(t){return T.roundPoint(t,this.minFitAllowed)}finalizeCurrentCurve(){if(!this.currentCurve){if(this.segments.length>0)return;const t=T.roundPoint(this.startPoint.width/3,this.minFitAllowed),e=this.roundPoint(this.startPoint.pos);return void this.segments.push({startPoint:this.startPoint.pos.plus(n.of(t,0)),commands:[{kind:J.QuadraticBezierTo,controlPoint:e.plus(n.of(t,t)),endPoint:e.plus(n.of(0,t))},{kind:J.QuadraticBezierTo,controlPoint:e.plus(n.of(-t,t)),endPoint:e.plus(n.of(-t,0))},{kind:J.QuadraticBezierTo,controlPoint:e.plus(n.of(-t,-t)),endPoint:e.plus(n.of(0,-t))},{kind:J.QuadraticBezierTo,controlPoint:e.plus(n.of(t,-t)),endPoint:e.plus(n.of(t,0))}],style:this.getRenderingStyle()})}this.segments.push(this.currentSegmentToPath());const t=this.buffer[this.buffer.length-1];this.lastExitingVec=n.ofXY(this.currentCurve.points[2]).minus(n.ofXY(this.currentCurve.points[1])),console.assert(0!==this.lastExitingVec.magnitude()),this.buffer=[this.buffer[this.buffer.length-2],t],this.currentCurve=null}currentSegmentToPath(){if(null==this.currentCurve)throw new Error("Invalid State: currentCurve is null!");let t=n.ofXY(this.currentCurve.normal(0)).normalized(),e=n.ofXY(this.currentCurve.normal(1)).normalized();t=t.times(this.curveStartWidth/2),e=e.times(this.curveEndWidth/2),isNaN(t.magnitude())&&(console.error("startVec is NaN",t,e,this.currentCurve),t=e);const r=n.ofXY(this.currentCurve.get(0)),i=n.ofXY(this.currentCurve.get(1)),o=n.ofXY(this.currentCurve.points[1]);let s=this.currentCurve.project(o.xy).t;s||(s=r.minus(o).magnitudeSquared()<i.minus(o).magnitudeSquared()?.1:.9);const a=n.ofXY(this.currentCurve.normal(s)).normalized().times(this.curveStartWidth/2*s+this.curveEndWidth/2*(1-s)),l=[{kind:J.QuadraticBezierTo,controlPoint:this.roundPoint(o.plus(a)),endPoint:this.roundPoint(i.plus(e))},{kind:J.LineTo,point:this.roundPoint(i.minus(e))},{kind:J.QuadraticBezierTo,controlPoint:this.roundPoint(o.minus(a)),endPoint:this.roundPoint(r.minus(t))}];return{startPoint:this.roundPoint(r.plus(t)),commands:l,style:this.getRenderingStyle()}}computeExitingVec(){return this.momentum.normalized().times(this.lastPoint.width/2)}addPoint(t){var e,r;if(this.lastPoint){const e=1e-10,n=t.time-this.lastPoint.time;if(t.pos.eq(this.lastPoint.pos,e)||0===n)return void console.warn("Discarding identical point");if(isNaN(t.pos.magnitude()))return void console.warn("Discarding NaN point.",t);const r=Math.min(this.lastPoint.width,t.width)/4;if(this.startPoint.pos.minus(t.pos).magnitude()<r&&0===this.segments.length)return;const i=t.pos.minus(this.lastPoint.pos).times(1/n*1e3);this.momentum=this.momentum.lerp(i,.9)}const i=null!==(e=this.lastPoint)&&void 0!==e?e:t;this.lastPoint=t,this.buffer.push(t.pos);const s=t.width/2,a=this.curveEndWidth;if(this.curveEndWidth=s,this.bbox=this.bbox.grownToPoint(t.pos,s),null===this.currentCurve){const e=i.pos,o=i.pos.plus(null!==(r=this.lastExitingVec)&&void 0!==r?r:n.unitX),s=t.pos;this.currentCurve=new K(e.xy,o.xy,s.xy),this.curveStartWidth=i.width/2,console.assert(!isNaN(e.magnitude())&&!isNaN(o.magnitude())&&!isNaN(s.magnitude()),"Expected !NaN")}let l=this.lastExitingVec;if(!l){let t=Math.ceil(this.buffer.length/3);0===t&&(t=this.buffer.length-1),l=this.buffer[t].minus(this.buffer[0])}let c=this.computeExitingVec();const h=this.buffer[0],d=t.pos,u=d.minus(h).magnitude(),p=2*u;if(0===p||0===c.magnitude()||isNaN(c.magnitude()))return;console.assert(!isNaN(l.magnitude())),l=l.normalized(),c=c.normalized(),console.assert(!isNaN(l.magnitude()));const f=new o(h,h.plus(l.times(p))),m=new o(d.minus(c.times(p)),d).intersection(f);let g;g=m?m.point:h.plus(l.times(u/4)),(isNaN(g.magnitude())||isNaN(h.magnitude()))&&console.error("controlPoint is NaN",m,"Start:",h,"End:",d,"in:",l,"out:",c);const v=this.currentCurve;this.currentCurve=new K(h.xy,g.xy,d.xy),isNaN(n.ofXY(this.currentCurve.normal(0)).magnitude())&&(console.error("NaN normal at 0. Curve:",this.currentCurve),this.currentCurve=v);const x=t=>{for(const e of this.buffer){const r=n.ofXY(t.project(e.xy)).minus(e).magnitude();if(r>Math.max(Math.min(this.curveStartWidth,this.curveEndWidth)/2,this.minFitAllowed)||r>this.maxFitAllowed)return!1}return!0};return this.buffer.length>3&&!x(this.currentCurve)?(this.currentCurve=v,this.curveEndWidth=a,this.lastPoint=i,void this.finalizeCurrentCurve()):void 0}}class ot extends C{constructor(t,e,n){super(t.notifier,e),this.editor=t,this.style=n,this.builder=null,this.builderFactory=rt,this.lastPoint=null,this.kind=mt.Pen}getPressureMultiplier(){return 1/this.editor.viewport.getScaleFactor()*this.style.thickness}getStrokePoint(t){var e;const n=Math.max(null!==(e=t.pressure)&&void 0!==e?e:1,.3);return{pos:t.canvasPos,width:n*this.getPressureMultiplier(),color:this.style.color,time:t.timeStamp}}previewStroke(){var t;this.editor.clearWetInk(),null===(t=this.builder)||void 0===t||t.preview(this.editor.display.getWetInkRenderer())}addPointToStroke(t){if(!this.builder)throw new Error("No stroke is currently being generated.");this.builder.addPoint(t),this.lastPoint=t,this.previewStroke()}onPointerDown({current:t,allPointers:e}){return t.device!==u.Eraser&&((1===e.length||t.device===u.Pen)&&(this.builder=this.builderFactory(this.getStrokePoint(t),this.editor.viewport),!0))}onPointerMove({current:t}){this.addPointToStroke(this.getStrokePoint(t))}onPointerUp({current:t}){var e,n;if(!this.builder)return;const r=this.getStrokePoint(t),i=Object.assign(Object.assign({},r),{width:null!==(n=null===(e=this.lastPoint)||void 0===e?void 0:e.width)&&void 0!==n?n:r.width});if(this.addPointToStroke(i),this.builder&&t.isPrimary){const t=this.builder.build();this.previewStroke();const e=!0,n=new m.AddElementCommand(t,e);this.editor.dispatch(n)}this.builder=null,this.editor.clearWetInk()}onGestureCancel(){this.editor.clearWetInk()}noteUpdated(){this.editor.notifier.dispatch(d.ToolUpdated,{kind:d.ToolUpdated,tool:this})}setColor(t){t.toHexString()!==this.style.color.toHexString()&&(this.style=Object.assign(Object.assign({},this.style),{color:t}),this.noteUpdated())}setThickness(t){t!==this.style.thickness&&(this.style=Object.assign(Object.assign({},this.style),{thickness:t}),this.noteUpdated())}setStrokeFactory(t){t!==this.builderFactory&&(this.builderFactory=t,this.noteUpdated())}getThickness(){return this.style.thickness}getColor(){return this.style.color}getStrokeFactory(){return this.builderFactory}}class st{constructor(){}notifyEnabled(t){var e;t!==this.activeTool&&(null===(e=this.activeTool)||void 0===e||e.setEnabled(!1),this.activeTool=t)}}class at{constructor(t){this.toRemove=t.map((t=>t))}apply(t){for(const e of this.toRemove){const n=t.image.findParent(e);n&&n.remove()}t.queueRerender()}unapply(t){for(const e of this.toRemove)t.image.findParent(e)||new m.AddElementCommand(e).apply(t);t.queueRerender()}description(t){if(0===this.toRemove.length)return t.erasedNoElements;let e=this.toRemove[0].description(t);for(const n of this.toRemove)if(n.description(t)!==e){e=t.elements;break}return t.eraseAction(e,this.toRemove.length)}}class lt extends C{constructor(t,e){super(t.notifier,e),this.editor=t,this.command=null,this.kind=mt.Eraser}onPointerDown(t){return(1===t.allPointers.length||t.current.device===u.Eraser)&&(this.lastPoint=t.current.canvasPos,this.toRemove=[],!0)}onPointerMove(t){var e;const n=t.current.canvasPos;if(0===n.minus(this.lastPoint).magnitude())return;const r=new o(this.lastPoint,n),i=r.bbox;this.toRemove.push(...this.editor.image.getElementsIntersectingRegion(i).filter((t=>t.intersects(r)))),null===(e=this.command)||void 0===e||e.unapply(this.editor),this.command=new at(this.toRemove),this.command.apply(this.editor),this.lastPoint=n}onPointerUp(t){var e;this.command&&this.toRemove.length>0&&(null===(e=this.command)||void 0===e||e.unapply(this.editor),this.editor.dispatch(this.command)),this.command=null}onGestureCancel(){var t;null===(t=this.command)||void 0===t||t.unapply(this.editor),this.command=null}}var ct=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};const ht=30,dt=(t,e,r)=>{t.style.touchAction="none";let i,o,s=!1;t.addEventListener("touchstart",(t=>t.preventDefault())),t.addEventListener("pointerdown",(e=>!!e.isPrimary&&(s=!0,t.setPointerCapture(e.pointerId),i=e.pageX,o=e.pageY,!0))),t.addEventListener("pointermove",(t=>{if(t.isPrimary&&s){const r=n.of(t.pageX-i,t.pageY-o);return e(r,n.of(t.offsetX,t.offsetY)),i=t.pageX,o=t.pageY,!0}return!1}));const a=t=>!!t.isPrimary&&(s=!1,r(),!0);t.addEventListener("pointerup",a),t.addEventListener("pointercancel",a)};class ut{constructor(t,e){this.startPoint=t,this.editor=e,this.boxRotation=this.editor.viewport.getRotationAngle(),this.selectedElems=[],this.region=s.bboxOf([t]),this.backgroundBox=document.createElement("div");const n=document.createElement("div"),r=document.createElement("div");this.rotateCircle=document.createElement("div");const i=document.createElement("div");this.backgroundBox.classList.add("selectionBox"),n.classList.add("draggableBackground"),r.classList.add("resizeCorner"),this.rotateCircle.classList.add("rotateCircle"),i.classList.add("rotateCircleContainer"),i.appendChild(this.rotateCircle),this.backgroundBox.appendChild(n),this.backgroundBox.appendChild(i),this.backgroundBox.appendChild(r),this.transformationCommands=[],this.transform=v.identity,dt(n,(t=>{this.handleBackgroundDrag(t)}),(()=>this.finishDragging())),dt(r,(t=>{this.handleResizeCornerDrag(t)}),(()=>this.finishDragging())),dt(this.rotateCircle,((t,e)=>{this.handleRotateCircleDrag(e)}),(()=>this.finishDragging()))}handleBackgroundDrag(t){t=this.editor.viewport.screenToCanvasTransform.transformVec3(t),t=this.editor.viewport.roundPoint(t),this.region=this.region.translatedBy(t),this.transform=this.transform.rightMul(v.translation(t)),this.previewTransformCmds()}handleResizeCornerDrag(t){t=this.editor.viewport.screenToCanvasTransform.transformVec3(t),t=this.editor.viewport.roundPoint(t);const e=this.region.w,r=this.region.h,i=this.region.size.plus(t);if(i.y>0&&i.x>0){this.region=this.region.resizedTo(i);const t=n.of(this.region.w/e,this.region.h/r),o=v.scaling2D(t,this.region.topLeft);this.transform=this.transform.rightMul(o),this.previewTransformCmds()}}handleRotateCircleDrag(t){this.boxRotation=this.boxRotation%(2*Math.PI),this.boxRotation<0&&(this.boxRotation+=2*Math.PI);let e=t.angle();e%=2*Math.PI,e<0&&(e+=2*Math.PI);let n=e-this.boxRotation;const r=Math.PI/12;if(!(Math.abs(n)<r)&&isFinite(n)){{const t=Math.sign(n);n=Math.floor(Math.abs(n)/r)*r,n*=t}this.transform=this.transform.rightMul(v.zRotation(n,this.region.center)),this.boxRotation+=n,this.previewTransformCmds()}}computeTransformCommands(){return this.selectedElems.map((t=>t.transformBy(this.transform)))}finishDragging(){this.transformationCommands.forEach((t=>{t.unapply(this.editor)}));const t=this.transform,e=this.transform.inverse(),n=this.boxRotation,r=this.computeTransformCommands();this.transformationCommands=[],this.transform=v.identity,this.region=this.region.transformedBoundingBox(e),this.editor.dispatch({apply:e=>ct(this,void 0,void 0,(function*(){this.region=this.region.transformedBoundingBox(t),this.boxRotation+=n,this.updateUI(),yield e.asyncApplyCommands(r,50),this.recomputeRegion(),this.updateUI()})),unapply:t=>ct(this,void 0,void 0,(function*(){this.region=this.region.transformedBoundingBox(e),this.boxRotation-=n,this.updateUI(),yield t.asyncUnapplyCommands(r,50),this.recomputeRegion(),this.updateUI()})),description:t=>t.transformedElements(r.length)})}previewTransformCmds(){this.selectedElems.length>50||(this.transformationCommands.forEach((t=>t.unapply(this.editor))),this.transformationCommands=this.computeTransformCommands(),this.transformationCommands.forEach((t=>t.apply(this.editor)))),this.updateUI()}appendBackgroundBoxTo(t){this.backgroundBox.parentElement&&this.backgroundBox.remove(),t.appendChild(this.backgroundBox)}setToPoint(t){this.region=this.region.grownToPoint(t),this.recomputeBoxRotation(),this.updateUI()}cancelSelection(){this.backgroundBox.parentElement&&this.backgroundBox.remove(),this.region=s.empty}resolveToObjects(){if(0===this.region.w||0===this.region.h){const t=this.editor.viewport.visibleRect.maxDimension/100;this.region=s.bboxOf(this.region.corners,t)}return this.selectedElems=this.editor.image.getElementsIntersectingRegion(this.region).filter((t=>!!this.region.containsRect(t.getBBox())||!!this.region.getEdges().some((e=>t.intersects(e))))),!!this.recomputeRegion()&&(this.updateUI(),!0)}recomputeRegion(){const t=this.selectedElems.reduce(((t,e)=>(null!=t?t:e.getBBox()).union(e.getBBox())),null);if(!t)return this.cancelSelection(),!1;this.region=t;const e=this.getMinCanvasSize();if(this.region.w<e||this.region.h<e){const t=e/2;this.region=s.bboxOf(this.region.corners,t)}return this.recomputeBoxRotation(),!0}getMinCanvasSize(){return 2*(ht/this.editor.viewport.getScaleFactor())}recomputeBoxRotation(){this.boxRotation=this.editor.viewport.getRotationAngle()}getSelectedItemCount(){return this.selectedElems.length}updateUI(){if(!this.backgroundBox)return;const t=this.region.topRight.minus(this.region.bottomRight),e=this.region.topLeft.minus(this.region.topRight),n=this.editor.viewport.canvasToScreenTransform,r=n.transformVec2(this.region.center),i=n.transformVec3(t).magnitude(),o=n.transformVec3(e).magnitude();this.backgroundBox.style.marginLeft=r.x-o/2+"px",this.backgroundBox.style.marginTop=r.y-i/2+"px",this.backgroundBox.style.width=`${o}px`,this.backgroundBox.style.height=`${i}px`;const s=180*this.boxRotation/Math.PI;this.backgroundBox.style.transform=`rotate(${s}deg)`,this.rotateCircle.style.transform=`rotate(${-s}deg)`}}class pt extends C{constructor(t,e){super(t.notifier,e),this.editor=t,this.kind=mt.Selection,this.handleOverlay=document.createElement("div"),t.createHTMLOverlay(this.handleOverlay),t.addStyleSheet("\n\t.handleOverlay {\n\t}\n\n\t.handleOverlay > .selectionBox {\n\t\tposition: fixed;\n\t\tz-index: 0;\n\t\ttransform-origin: center;\n\t}\n\n\t.handleOverlay > .selectionBox .draggableBackground {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\n\t\tbackground-color: var(--secondary-background-color);\n\t\topacity: 0.8;\n\t\tborder: 1px solid var(--primary-background-color);\n\t}\n\n\t.handleOverlay .resizeCorner {\n\t\twidth: 30px;\n\t\theight: 30px;\n\t\tmargin-right: -15px;\n\t\tmargin-bottom: -15px;\n\n\t\tposition: absolute;\n\t\tbottom: 0;\n\t\tright: 0;\n\n\t\topacity: 0.8;\n\t\tbackground-color: var(--primary-background-color);\n\t\tborder: 1px solid var(--primary-foreground-color);\n\t}\n\n\t.handleOverlay > .selectionBox .rotateCircleContainer {\n\t\tposition: absolute;\n\t\ttop: 50%;\n\t\tbottom: 50%;\n\t\tleft: 50%;\n\t\tright: 50%;\n\t}\n\n\t.handleOverlay .rotateCircle {\n\t\twidth: 30px;\n\t\theight: 30px;\n\t\tmargin-left: -15px;\n\t\tmargin-top: -15px;\n\t\topacity: 0.8;\n\n\t\tborder: 1px solid var(--primary-foreground-color);\n\t\tbackground-color: var(--primary-background-color);\n\t\tborder-radius: 100%;\n\t}\n"),this.handleOverlay.style.display="none",this.handleOverlay.classList.add("handleOverlay"),t.notifier.on(d.ViewportChanged,(t=>{var e,n;null===(e=this.selectionBox)||void 0===e||e.recomputeRegion(),null===(n=this.selectionBox)||void 0===n||n.updateUI()}))}onPointerDown(t){return!(1!==t.allPointers.length||!t.current.isPrimary)&&(this.prevSelectionBox=this.selectionBox,this.selectionBox=new ut(t.current.canvasPos,this.editor),this.handleOverlay.replaceChildren(),this.selectionBox.appendBackgroundBoxTo(this.handleOverlay),!0)}onPointerMove(t){this.selectionBox&&this.selectionBox.setToPoint(t.current.canvasPos)}onGestureEnd(){if(!this.selectionBox)return;const t=this.selectionBox.resolveToObjects();if(this.editor.notifier.dispatch(d.ToolUpdated,{kind:d.ToolUpdated,tool:this}),t){const t=this.editor.viewport.visibleRect,e=this.selectionBox.region;this.editor.announceForAccessibility(this.editor.localization.selectedElements(this.selectionBox.getSelectedItemCount()));const n=t.transformedBoundingBox(v.scaling2D(2/3,t.center));if(n.w<e.w||n.h<e.h){const t=Math.max(e.w/n.w,e.h/n.h),r=v.scaling2D(t,n.topLeft).inverse();new T.ViewportTransform(r).apply(this.editor)}if(!n.containsRect(e)){const t=e.center.minus(n.center),r=v.translation(t).inverse();new T.ViewportTransform(r).apply(this.editor)}}}onPointerUp(t){this.selectionBox&&(this.selectionBox.setToPoint(t.current.canvasPos),this.onGestureEnd())}onGestureCancel(){var t,e;null===(t=this.selectionBox)||void 0===t||t.cancelSelection(),this.selectionBox=this.prevSelectionBox,null===(e=this.selectionBox)||void 0===e||e.appendBackgroundBoxTo(this.handleOverlay)}setEnabled(t){super.setEnabled(t),this.handleOverlay.replaceChildren(),this.selectionBox=null,this.handleOverlay.style.display=t?"block":"none"}getSelection(){return this.selectionBox}}class ft{constructor(t,e,n,r){this.r=t,this.g=e,this.b=n,this.a=r,this.hexString=null}static ofRGB(t,e,n){return new ft(t,e,n,1)}static ofRGBA(t,e,n,r){return new ft(t,e,n,r)}static fromHex(t){var e;if(!(t=(t=(null!==(e=t.match(/^[#]?(.*)$/))&&void 0!==e?e:[])[1]).toUpperCase()).match(/^[0-9A-F]+$/))throw new Error(`${t} is not in a valid format.`);if(3===t.length||4===t.length){const e=t.split("");t=e.map((t=>`${t}0`)).join("")}6===t.length&&(t+="FF");const n=[];for(let e=2;e<=t.length;e+=2){const r=t.substring(e-2,e);n.push(parseInt(r,16)/255)}if(4!==n.length)throw new Error(`Unable to parse ${t}: Wrong number of components.`);return new ft(n[0],n[1],n[2],n[3])}static fromString(t){if(t.startsWith("#"))return ft.fromHex(t);{const e=document.createElement("canvas");e.width=1,e.height=1;const n=e.getContext("2d");n.fillStyle=t,n.fillRect(0,0,1,1);const r=n.getImageData(0,0,1,1),i=r.data[0]/255,o=r.data[1]/255,s=r.data[2]/255,a=r.data[3]/255;return ft.ofRGBA(i,o,s,a)}}eq(t){return null!=t&&this.toHexString()===t.toHexString()}toHexString(){if(this.hexString)return this.hexString;const t=t=>{const e=Math.round(255*t).toString(16);return 1===e.length?`0${e}`:e},e=t(this.a),n=t(this.r),r=t(this.g),i=t(this.b);return"ff"===e?`#${n}${r}${i}`:(this.hexString=`#${n}${r}${i}${e}`,this.hexString)}}var mt;ft.transparent=ft.ofRGBA(0,0,0,0),ft.red=ft.ofRGB(1,0,0),ft.green=ft.ofRGB(0,1,0),ft.blue=ft.ofRGB(0,0,1),ft.purple=ft.ofRGB(.5,.2,.5),ft.yellow=ft.ofRGB(1,1,.1),ft.clay=ft.ofRGB(.8,.4,.2),ft.black=ft.ofRGB(0,0,0),ft.white=ft.ofRGB(1,1,1),function(t){t[t.TouchPanZoom=0]="TouchPanZoom",t[t.Pen=1]="Pen",t[t.Selection=2]="Selection",t[t.Eraser=3]="Eraser",t[t.PanZoom=4]="PanZoom"}(mt||(mt={}));class gt{constructor(t,e){const n=new st,r=new S(t,E.OneFingerGestures,e.touchPanTool),i=new ot(t,e.penTool(1),{color:ft.purple,thickness:16}),o=[new pt(t,e.selectionTool),new lt(t,e.eraserTool),i,new ot(t,e.penTool(2),{color:ft.clay,thickness:8}),new ot(t,e.penTool(3),{color:ft.ofRGBA(1,1,0,.5),thickness:64})];this.tools=[r,...o,new S(t,E.TwoFingerGestures|E.AnyDevice,e.twoFingerPanZoomTool)],o.forEach((t=>t.setToolGroup(n))),r.setEnabled(!1),i.setEnabled(!0),t.notifier.on(d.ToolEnabled,(n=>{n.kind===d.ToolEnabled&&t.announceForAccessibility(e.toolEnabledAnnouncement(n.tool.description))})),t.notifier.on(d.ToolDisabled,(n=>{n.kind===d.ToolDisabled&&t.announceForAccessibility(e.toolDisabledAnnouncement(n.tool.description))})),this.activeTool=null}dispatchInputEvent(t){var e,n;let r=!1;if(t.kind===h.PointerDownEvt){for(const n of this.tools)if(n.isEnabled()&&n.onPointerDown(t)){this.activeTool!==n&&(null===(e=this.activeTool)||void 0===e||e.onGestureCancel()),this.activeTool=n,r=!0;break}}else if(t.kind===h.PointerUpEvt)null===(n=this.activeTool)||void 0===n||n.onPointerUp(t),this.activeTool=null,r=!0;else if(t.kind===h.WheelEvt||t.kind===h.KeyPressEvent){const e=t.kind===h.KeyPressEvent,n=t.kind===h.WheelEvt;for(const i of this.tools){if(!i.isEnabled())continue;const o=n&&i.onWheel(t);if(r=e&&i.onKeyPress(t)||o,r)break}}else if(null!==this.activeTool){let e;switch(t.kind){case h.PointerMoveEvt:this.activeTool.onPointerMove(t);break;case h.GestureCancelEvt:this.activeTool.onGestureCancel(),this.activeTool=null;break;default:return e=t,e}r=!0}else r=!1;return r}getMatchingTools(t){return this.tools.filter((e=>e.kind===t))}}const vt=class{constructor(t,e,n){this.editor=t,this.announceRedoCallback=e,this.announceUndoCallback=n,this.undoStack=[],this.redoStack=[]}fireUpdateEvent(){this.editor.notifier.dispatch(d.UndoRedoStackUpdated,{kind:d.UndoRedoStackUpdated,undoStackSize:this.undoStack.length,redoStackSize:this.redoStack.length})}push(t,e=!0){e&&t.apply(this.editor),this.undoStack.push(t),this.redoStack=[],this.fireUpdateEvent()}undo(){const t=this.undoStack.pop();t&&(this.redoStack.push(t),t.unapply(this.editor),this.announceUndoCallback(t)),this.fireUpdateEvent()}redo(){const t=this.redoStack.pop();t&&(this.undoStack.push(t),t.apply(this.editor),this.announceRedoCallback(t)),this.fireUpdateEvent()}};class xt{constructor(){this.listeners={}}dispatch(t,e){const n=this.listeners[t];if(n)for(let t=0;t<n.length;t++)n[t](e)}on(t,e){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e),{remove:()=>{const n=this.listeners[t];return this.off(t,e),n.length!==this.listeners[t].length}}}off(t,e){const n=this.listeners[t];n&&(this.listeners[t]=n.filter((t=>t!==e)))}}var bt=function(t,e,n){var r,i,o,s,a,l,c,h,d,u,p,f,m,g,v,x=e.createElement("canvas").getContext("2d"),b={r:0,g:0,b:0,h:0,s:0,v:0,a:1},y={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",a11y:{open:"Open color picker",close:"Close color picker",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},w={},k="",P={},T=!1;function C(n){if("object"==typeof n)for(var s in n)switch(s){case"el":B(n.el),!1!==n.wrap&&R(n.el);break;case"parent":(r=e.querySelector(n.parent))&&(r.appendChild(i),y.parent=n.parent,r===e.body&&(r=null));break;case"themeMode":y.themeMode=n.themeMode,"auto"===n.themeMode&&t.matchMedia&&t.matchMedia("(prefers-color-scheme: dark)").matches&&(y.themeMode="dark");case"theme":n.theme&&(y.theme=n.theme),i.className="clr-picker clr-"+y.theme+" clr-"+y.themeMode,y.inline&&L();break;case"margin":n.margin*=1,y.margin=isNaN(n.margin)?y.margin:n.margin;break;case"wrap":n.el&&n.wrap&&R(n.el);break;case"formatToggle":y.formatToggle=!!n.formatToggle,W("clr-format").style.display=y.formatToggle?"block":"none",y.formatToggle&&(y.format="auto");break;case"swatches":Array.isArray(n.swatches)&&function(){var t=[];n.swatches.forEach((function(e,n){t.push('<button type="button" id="clr-swatch-'+n+'" aria-labelledby="clr-swatch-label clr-swatch-'+n+'" style="color: '+e+';">'+e+"</button>")})),W("clr-swatches").innerHTML=t.length?"<div>"+t.join("")+"</div>":"",y.swatches=n.swatches.slice()}();break;case"swatchesOnly":y.swatchesOnly=!!n.swatchesOnly,i.setAttribute("data-minimal",y.swatchesOnly);break;case"alpha":y.alpha=!!n.alpha,i.setAttribute("data-alpha",y.alpha);break;case"inline":if(y.inline=!!n.inline,i.setAttribute("data-inline",y.inline),y.inline){var a=n.defaultColor||y.defaultColor;g=I(a),L(),A(a)}break;case"clearButton":"object"==typeof n.clearButton&&(n.clearButton.label&&(y.clearLabel=n.clearButton.label,h.innerHTML=y.clearLabel),n.clearButton=n.clearButton.show),y.clearButton=!!n.clearButton,h.style.display=y.clearButton?"block":"none";break;case"clearLabel":y.clearLabel=n.clearLabel,h.innerHTML=y.clearLabel;break;case"a11y":var u=n.a11y,f=!1;if("object"==typeof u)for(var m in u)u[m]&&y.a11y[m]&&(y.a11y[m]=u[m],f=!0);if(f){var v=W("clr-open-label"),x=W("clr-swatch-label");v.innerHTML=y.a11y.open,x.innerHTML=y.a11y.swatch,l.setAttribute("aria-label",y.a11y.close),d.setAttribute("aria-label",y.a11y.hueSlider),p.setAttribute("aria-label",y.a11y.alphaSlider),c.setAttribute("aria-label",y.a11y.input),o.setAttribute("aria-label",y.a11y.instruction)}default:y[s]=n[s]}}function E(t,e){"string"==typeof t&&"object"==typeof e&&(w[t]=e,T=!0)}function S(t){delete w[t],0===Object.keys(w).length&&(T=!1,t===k&&z())}function z(){Object.keys(P).length>0&&(C(P),k="",P={})}function B(t){G(e,"click",t,(function(t){y.inline||(function(t){if(T){var e=["el","wrap","inline","defaultColor","a11y"],n=function(n){var r=w[n];if(t.matches(n)){for(var i in k=n,P={},e.forEach((function(t){return delete r[t]})),r)P[i]=Array.isArray(y[i])?y[i].slice():y[i];return C(r),"break"}};for(var r in w)if("break"===n(r))break}}(t.target),m=t.target,v=m.value,g=I(v),i.classList.add("clr-open"),L(),A(v),(y.focusInput||y.selectInput)&&c.focus({preventScroll:!0}),y.selectInput&&c.select(),m.dispatchEvent(new Event("open",{bubbles:!0})))})),G(e,"input",t,(function(t){var e=t.target.parentNode;e.classList.contains("clr-field")&&(e.style.color=t.target.value)}))}function L(){var n,a,l,c=r,h=t.scrollY,d=i.offsetWidth,u=i.offsetHeight,p={left:!1,top:!1},f={x:0,y:0};if(c&&(n=t.getComputedStyle(c),a=parseFloat(n.marginTop),l=parseFloat(n.borderTopWidth),(f=c.getBoundingClientRect()).y+=l+h),!y.inline){var g=m.getBoundingClientRect(),v=g.x,x=h+g.y+g.height+y.margin;c?(v-=f.x,x-=f.y,v+d>c.clientWidth&&(v+=g.width-d,p.left=!0),x+u>c.clientHeight-a&&u+y.margin<=g.top-(f.y-h)&&(x-=g.height+u+2*y.margin,p.top=!0),x+=c.scrollTop):(v+d>e.documentElement.clientWidth&&(v+=g.width-d,p.left=!0),x+u-h>e.documentElement.clientHeight&&u+y.margin<=g.top&&(x=h+g.y-u-y.margin,p.top=!0)),i.classList.toggle("clr-left",p.left),i.classList.toggle("clr-top",p.top),i.style.left=v+"px",i.style.top=x+"px"}s={width:o.offsetWidth,height:o.offsetHeight,x:i.offsetLeft+o.offsetLeft+f.x,y:i.offsetTop+o.offsetTop+f.y}}function R(t){e.querySelectorAll(t).forEach((function(t){var n=t.parentNode;if(!n.classList.contains("clr-field")){var r=e.createElement("div");r.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',n.insertBefore(r,t),r.setAttribute("class","clr-field"),r.style.color=t.value,r.appendChild(t)}}))}function M(t){m&&!y.inline&&(t&&v!==m.value&&(m.value=v,m.dispatchEvent(new Event("input",{bubbles:!0}))),v!==m.value&&m.dispatchEvent(new Event("change",{bubbles:!0})),i.classList.remove("clr-open"),T&&z(),m.dispatchEvent(new Event("close",{bubbles:!0})),y.focusInput&&m.focus({preventScroll:!0}),m=null)}function A(t){var e=function(t){var e,n,r=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i;return x.fillStyle="#000",x.fillStyle=t,(e=r.exec(x.fillStyle))?(n={r:1*e[3],g:1*e[4],b:1*e[5],a:1*e[6]}).a=+n.a.toFixed(2):n={r:(e=x.fillStyle.replace("#","").match(/.{2}/g).map((function(t){return parseInt(t,16)})))[0],g:e[1],b:e[2],a:1},n}(t),r=function(t){var e=t.r/255,r=t.g/255,i=t.b/255,o=n.max(e,r,i),s=n.min(e,r,i),a=o-s,l=o,c=0,h=0;return a&&(o===e&&(c=(r-i)/a),o===r&&(c=2+(i-e)/a),o===i&&(c=4+(e-r)/a),o&&(h=a/o)),{h:(c=n.floor(60*c))<0?c+360:c,s:n.round(100*h),v:n.round(100*l),a:t.a}}(e);j(r.s,r.v),F(e,r),d.value=r.h,i.style.color="hsl("+r.h+", 100%, 50%)",u.style.left=r.h/360*100+"%",a.style.left=s.width*r.s/100+"px",a.style.top=s.height-s.height*r.v/100+"px",p.value=100*r.a,f.style.left=100*r.a+"%"}function I(t){var e=t.substring(0,3).toLowerCase();return"rgb"===e||"hsl"===e?e:"hex"}function D(t){t=void 0!==t?t:c.value,m&&(m.value=t,m.dispatchEvent(new Event("input",{bubbles:!0}))),e.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:t}}))}function O(t,e){var r={h:1*d.value,s:t/s.width*100,v:100-e/s.height*100,a:p.value/100},i=function(t){var e=t.s/100,r=t.v/100,i=e*r,o=t.h/60,s=i*(1-n.abs(o%2-1)),a=r-i;i+=a,s+=a;var l=n.floor(o)%6,c=[i,s,a,a,s,i][l],h=[s,i,i,s,a,a][l],d=[a,a,s,i,i,s][l];return{r:n.round(255*c),g:n.round(255*h),b:n.round(255*d),a:t.a}}(r);j(r.s,r.v),F(i,r),D()}function j(t,e){var n=y.a11y.marker;t=1*t.toFixed(1),e=1*e.toFixed(1),n=(n=n.replace("{s}",t)).replace("{v}",e),a.setAttribute("aria-label",n)}function N(t){var e=function(t){return{pageX:t.changedTouches?t.changedTouches[0].pageX:t.pageX,pageY:t.changedTouches?t.changedTouches[0].pageY:t.pageY}}(t),n=e.pageX-s.x,i=e.pageY-s.y;r&&(i+=r.scrollTop),n=n<0?0:n>s.width?s.width:n,i=i<0?0:i>s.height?s.height:i,a.style.left=n+"px",a.style.top=i+"px",O(n,i),t.preventDefault(),t.stopPropagation()}function V(t,e){var n=1*a.style.left.replace("px","")+t,r=1*a.style.top.replace("px","")+e;a.style.left=n+"px",a.style.top=r+"px",O(n,r)}function F(t,r){void 0===t&&(t={}),void 0===r&&(r={});var i=y.format;for(var s in t)b[s]=t[s];for(var h in r)b[h]=r[h];var d,u=function(t){var e=t.r.toString(16),n=t.g.toString(16),r=t.b.toString(16),i="";if(t.r<16&&(e="0"+e),t.g<16&&(n="0"+n),t.b<16&&(r="0"+r),y.alpha&&(t.a<1||y.forceAlpha)){var o=255*t.a|0;i=o.toString(16),o<16&&(i="0"+i)}return"#"+e+n+r+i}(b),p=u.substring(0,7);switch(a.style.color=p,f.parentNode.style.color=p,f.style.color=u,l.style.color=u,o.style.display="none",o.offsetHeight,o.style.display="",f.nextElementSibling.style.display="none",f.nextElementSibling.offsetHeight,f.nextElementSibling.style.display="","mixed"===i?i=1===b.a?"hex":"rgb":"auto"===i&&(i=g),i){case"hex":c.value=u;break;case"rgb":c.value=function(t){return!y.alpha||1===t.a&&!y.forceAlpha?"rgb("+t.r+", "+t.g+", "+t.b+")":"rgba("+t.r+", "+t.g+", "+t.b+", "+t.a+")"}(b);break;case"hsl":c.value=(d=function(t){var e,r=t.v/100,i=r*(1-t.s/100/2);return i>0&&i<1&&(e=n.round((r-i)/n.min(i,1-i)*100)),{h:t.h,s:e||0,l:n.round(100*i),a:t.a}}(b),!y.alpha||1===d.a&&!y.forceAlpha?"hsl("+d.h+", "+d.s+"%, "+d.l+"%)":"hsla("+d.h+", "+d.s+"%, "+d.l+"%, "+d.a+")")}e.querySelector('.clr-format [value="'+i+'"]').checked=!0}function $(){var t=1*d.value,e=1*a.style.left.replace("px",""),n=1*a.style.top.replace("px","");i.style.color="hsl("+t+", 100%, 50%)",u.style.left=t/360*100+"%",O(e,n)}function U(){var t=p.value/100;f.style.left=100*t+"%",F({a:t}),D()}function _(){r=null,(i=e.createElement("div")).setAttribute("id","clr-picker"),i.className="clr-picker",i.innerHTML='<input id="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="'+y.a11y.input+'"><div id="clr-color-area" class="clr-gradient" role="application" aria-label="'+y.a11y.instruction+'"><div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue"><input id="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="'+y.a11y.hueSlider+'"><div id="clr-hue-marker"></div></div><div class="clr-alpha"><input id="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="'+y.a11y.alphaSlider+'"><div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented"><legend>'+y.a11y.format+'</legend><input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div><button type="button" id="clr-clear" class="clr-clear">'+y.clearLabel+'</button><button type="button" id="clr-color-preview" class="clr-preview" aria-label="'+y.a11y.close+'"></button><span id="clr-open-label" hidden>'+y.a11y.open+'</span><span id="clr-swatch-label" hidden>'+y.a11y.swatch+"</span>",e.body.appendChild(i),o=W("clr-color-area"),a=W("clr-color-marker"),h=W("clr-clear"),l=W("clr-color-preview"),c=W("clr-color-value"),d=W("clr-hue-slider"),u=W("clr-hue-marker"),p=W("clr-alpha-slider"),f=W("clr-alpha-marker"),B(y.el),R(y.el),G(i,"mousedown",(function(t){i.classList.remove("clr-keyboard-nav"),t.stopPropagation()})),G(o,"mousedown",(function(t){G(e,"mousemove",N)})),G(o,"touchstart",(function(t){e.addEventListener("touchmove",N,{passive:!1})})),G(a,"mousedown",(function(t){G(e,"mousemove",N)})),G(a,"touchstart",(function(t){e.addEventListener("touchmove",N,{passive:!1})})),G(c,"change",(function(t){A(c.value),D()})),G(h,"click",(function(t){D(""),M()})),G(l,"click",(function(t){D(),M()})),G(e,"click",".clr-format input",(function(t){g=t.target.value,F(),D()})),G(i,"click",".clr-swatches button",(function(t){A(t.target.textContent),D(),y.swatchesOnly&&M()})),G(e,"mouseup",(function(t){e.removeEventListener("mousemove",N)})),G(e,"touchend",(function(t){e.removeEventListener("touchmove",N)})),G(e,"mousedown",(function(t){i.classList.remove("clr-keyboard-nav"),M()})),G(e,"keydown",(function(t){"Escape"===t.key?M(!0):"Tab"===t.key&&i.classList.add("clr-keyboard-nav")})),G(e,"click",".clr-field button",(function(t){T&&z(),t.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))})),G(a,"keydown",(function(t){var e={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};-1!==Object.keys(e).indexOf(t.key)&&(V.apply(void 0,e[t.key]),t.preventDefault())})),G(o,"click",N),G(d,"input",$),G(p,"input",U)}function W(t){return e.getElementById(t)}function G(t,e,n,r){var i=Element.prototype.matches||Element.prototype.msMatchesSelector;"string"==typeof n?t.addEventListener(e,(function(t){i.call(t.target,n)&&r.call(t.target,t)})):(r=n,t.addEventListener(e,r))}function H(t,n){n=void 0!==n?n:[],"loading"!==e.readyState?t.apply(void 0,n):e.addEventListener("DOMContentLoaded",(function(){t.apply(void 0,n)}))}void 0!==NodeList&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);var Z=function(){var t={init:_,set:C,wrap:R,close:M,setInstance:E,removeInstance:S,updatePosition:L};function e(t){H((function(){t&&("string"==typeof t?B(t):C(t))}))}var n=function(n){e[n]=function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];H(t[n],r)}};for(var r in t)n(r);return e}();return Z.coloris=Z,Z}(window,document,Math),yt=bt.coloris,wt=bt.init;bt.set,bt.wrap,bt.close;const kt=(t,e)=>{var n,r,i,o,s;return t===e||t.fill.eq(e.fill)&&(null===(r=null===(n=t.stroke)||void 0===n?void 0:n.color)||void 0===r?void 0:r.eq(null===(i=e.stroke)||void 0===i?void 0:i.color))&&(null===(o=t.stroke)||void 0===o?void 0:o.width)===(null===(s=e.stroke)||void 0===s?void 0:s.width)};class Pt{constructor(t){this.viewport=t,this.objectLevel=0,this.currentPaths=null}flushPath(){if(!this.currentPaths)return;let t=null;for(const e of this.currentPaths){const{startPoint:n,commands:r,style:i}=e;t&&kt(t,i)?this.moveTo(n):(t&&this.endPath(t),this.beginPath(n),t=i);for(const t of r)t.kind===J.LineTo?this.lineTo(t.point):t.kind===J.MoveTo?this.moveTo(t.point):t.kind===J.CubicBezierTo?this.traceCubicBezierCurve(t.controlPoint1,t.controlPoint2,t.endPoint):t.kind===J.QuadraticBezierTo&&this.traceQuadraticBezierCurve(t.controlPoint,t.endPoint)}t&&this.endPath(t)}drawPath(t){0===this.objectLevel?(this.currentPaths=[t],this.flushPath(),this.currentPaths=null):this.currentPaths.push(t)}drawRect(t,e,n){const r=tt.fromRect(t,e);this.drawPath(r.toRenderable(n))}startObject(t){this.currentPaths=[],this.objectLevel++}endObject(){if(this.flushPath(),this.currentPaths=null,this.objectLevel--,this.objectLevel<0)throw new Error("More objects have ended than have been started (negative object nesting level)!")}getNestingLevel(){return this.objectLevel}}const Tt="http://www.w3.org/2000/svg";class Ct extends Pt{constructor(t,e){super(e),this.elem=t,this.clear()}displaySize(){return n.of(this.elem.clientWidth,this.elem.clientHeight)}clear(){this.mainGroup=document.createElementNS(Tt,"g"),this.elem.replaceChildren(this.mainGroup)}beginPath(t){var e;this.currentPath=[],this.pathStart=this.viewport.canvasToScreen(t),null!==(e=this.lastPathStart)&&void 0!==e||(this.lastPathStart=this.pathStart)}endPath(t){var e;if(null==this.currentPath)throw new Error("No path exists to end! Make sure beginPath was called!");t.fill.eq(null===(e=this.lastPathStyle)||void 0===e?void 0:e.fill)&&null!=this.lastPath?(this.lastPath.push({kind:J.MoveTo,point:this.pathStart},...this.currentPath),this.pathStart=null,this.currentPath=null):(this.addPathToSVG(),this.lastPathStart=this.pathStart,this.lastPathStyle=t,this.lastPath=this.currentPath,this.pathStart=null,this.currentPath=null)}addPathToSVG(){if(!this.lastPathStyle||!this.lastPath)return;const t=document.createElementNS(Tt,"path");t.setAttribute("d",tt.toString(this.lastPathStart,this.lastPath));const e=this.lastPathStyle;t.setAttribute("fill",e.fill.toHexString()),e.stroke&&(t.setAttribute("stroke",e.stroke.color.toHexString()),t.setAttribute("stroke-width",e.stroke.width.toString())),this.mainGroup.appendChild(t)}startObject(t){super.startObject(t),this.lastPath=null,this.lastPathStart=null,this.lastPathStyle=null}endObject(){super.endObject(),this.addPathToSVG()}lineTo(t){t=this.viewport.canvasToScreen(t),this.currentPath.push({kind:J.LineTo,point:t})}moveTo(t){t=this.viewport.canvasToScreen(t),this.currentPath.push({kind:J.MoveTo,point:t})}traceCubicBezierCurve(t,e,n){t=this.viewport.canvasToScreen(t),e=this.viewport.canvasToScreen(e),n=this.viewport.canvasToScreen(n),this.currentPath.push({kind:J.CubicBezierTo,controlPoint1:t,controlPoint2:e,endPoint:n})}traceQuadraticBezierCurve(t,e){t=this.viewport.canvasToScreen(t),e=this.viewport.canvasToScreen(e),this.currentPath.push({kind:J.QuadraticBezierTo,controlPoint:t,endPoint:e})}drawPoints(...t){t.map((t=>{const e=document.createElementNS(Tt,"circle");e.setAttribute("cx",`${t.x}`),e.setAttribute("cy",`${t.y}`),e.setAttribute("r","15"),this.mainGroup.appendChild(e)}))}drawSVGElem(t){this.elem.appendChild(t.cloneNode(!0))}}const Et=(t,e)=>new St(t);class St{constructor(t){this.startPoint=t,this.endPoint=t}getLineWidth(){return Math.max(this.endPoint.width,this.startPoint.width)}getBBox(){return this.buildPreview().getBBox()}buildPreview(){const t=this.startPoint.pos,e=this.endPoint.pos,n=e.minus(t).normalized(),r=e.minus(t).length(),i=Math.min(this.getLineWidth(),r/2),o=this.startPoint.width/2,s=this.endPoint.width/2,a=e.minus(n.times(i)),l=n.orthog(),c=l.times(o),h=l.times(s);return new nt([{startPoint:a.minus(h),commands:[{kind:J.LineTo,point:t.minus(c)},{kind:J.LineTo,point:t.plus(c)},{kind:J.LineTo,point:a.plus(h)},{kind:J.LineTo,point:a.plus(l.times(i).plus(h))},{kind:J.LineTo,point:e.plus(n.times(s))},{kind:J.LineTo,point:a.plus(l.times(-i).minus(h))},{kind:J.LineTo,point:a.minus(h)}],style:{fill:this.startPoint.color}}])}build(){return this.buildPreview()}preview(t){this.buildPreview().render(t)}addPoint(t){this.endPoint=t}}const zt=(t,e)=>new Bt(t);class Bt{constructor(t){this.startPoint=t,this.endPoint=t}getBBox(){return this.buildPreview().getBBox()}buildPreview(){const t=this.startPoint.pos,e=this.endPoint.pos,n=e.minus(t).normalized(),r=this.startPoint.width/2,i=this.endPoint.width/2,o=n.orthog(),s=o.times(r),a=o.times(i);return new nt([{startPoint:t.minus(s),commands:[{kind:J.LineTo,point:t.plus(s)},{kind:J.LineTo,point:e.plus(a)},{kind:J.LineTo,point:e.minus(a)}],style:{fill:this.startPoint.color}}])}build(){return this.buildPreview()}preview(t){this.buildPreview().render(t)}addPoint(t){this.endPoint=t}}const Lt=(t,e)=>new Mt(t,!0),Rt=(t,e)=>new Mt(t,!1);class Mt{constructor(t,e){this.startPoint=t,this.filled=e,this.endPoint=t}getBBox(){return this.buildPreview().getBBox()}buildPreview(){const t=this.startPoint.pos,e=this.endPoint.pos,n=tt.fromRect(s.fromCorners(t,e),this.filled?null:this.endPoint.width);return new nt([n.toRenderable({fill:this.endPoint.color})])}build(){return this.buildPreview()}preview(t){this.buildPreview().render(t)}addPoint(t){this.endPoint=t}}const At="\n\tstyle='fill: var(--primary-foreground-color);'\n",It="\n\tstyle='fill: var(--primary-foreground-color); stroke: var(--primary-foreground-color);'\n",Dt="http://www.w3.org/2000/svg";class Ot{constructor(t,e,n){this.editor=t,this.targetTool=e,this.localizationTable=n,this.icon=null,this.container=document.createElement("div"),this.container.classList.add("toolbar-toolContainer"),this.dropdownContainer=document.createElement("div"),this.dropdownContainer.classList.add("toolbar-dropdown"),this.dropdownContainer.classList.add("hidden"),this.hasDropdown=!1,this.button=document.createElement("div"),this.button.classList.add("toolbar-button"),this.label=document.createElement("label"),this.button.setAttribute("role","button"),this.button.tabIndex=0,this.button.onclick=()=>{this.handleClick()},t.notifier.on(d.ToolEnabled,(t=>{if(t.kind!==d.ToolEnabled)throw new Error("Incorrect event type! (Expected ToolEnabled)");t.tool===e&&this.updateSelected(!0)})),t.notifier.on(d.ToolDisabled,(t=>{if(t.kind!==d.ToolDisabled)throw new Error("Incorrect event type! (Expected ToolDisabled)");t.tool===e&&(this.updateSelected(!1),this.setDropdownVisible(!1))}))}handleClick(){this.hasDropdown?this.targetTool.isEnabled()?this.setDropdownVisible(!this.isDropdownVisible()):this.targetTool.setEnabled(!0):this.targetTool.setEnabled(!this.targetTool.isEnabled())}addTo(t){this.label.innerText=this.getTitle(),this.icon=null,this.updateIcon(),this.updateSelected(this.targetTool.isEnabled()),this.button.replaceChildren(this.icon,this.label),this.container.appendChild(this.button),this.hasDropdown=this.fillDropdown(this.dropdownContainer),this.hasDropdown&&(this.dropdownIcon=this.createDropdownIcon(),this.button.appendChild(this.dropdownIcon),this.container.appendChild(this.dropdownContainer)),this.setDropdownVisible(!1),t.appendChild(this.container)}updateIcon(){var t;const e=this.createIcon();null===(t=this.icon)||void 0===t||t.replaceWith(e),this.icon=e,this.icon.classList.add("toolbar-icon")}updateSelected(t){this.container.classList.contains("selected")!==t&&(t?(this.container.classList.add("selected"),this.button.ariaSelected="true"):(this.container.classList.remove("selected"),this.button.ariaSelected="false"))}setDropdownVisible(t){this.container.classList.contains("dropdownVisible")!==t&&(t?(this.dropdownContainer.classList.remove("hidden"),this.container.classList.add("dropdownVisible"),this.editor.announceForAccessibility(this.localizationTable.dropdownShown(this.targetTool.description))):(this.dropdownContainer.classList.add("hidden"),this.container.classList.remove("dropdownVisible"),this.editor.announceForAccessibility(this.localizationTable.dropdownHidden(this.targetTool.description))))}isDropdownVisible(){return!this.dropdownContainer.classList.contains("hidden")}createDropdownIcon(){const t=document.createElementNS(Dt,"svg");return t.innerHTML=`\n\t\t<g>\n\t\t\t<path\n\t\t\t\td='M5,10 L50,90 L95,10 Z'\n\t\t\t\t${At}\n\t\t\t/>\n\t\t</g>\n\t\t`,t.classList.add("toolbar-showHideDropdownIcon"),t.setAttribute("viewBox","0 0 100 100"),t}}class jt extends Ot{getTitle(){return this.localizationTable.eraser}createIcon(){const t=document.createElementNS(Dt,"svg");return t.innerHTML=`\n\t\t<g>\n\t\t\t<rect x=10 y=50 width=80 height=30 rx=10 fill='pink' />\n\t\t\t<rect\n\t\t\t\tx=10 y=10 width=80 height=50\n\t\t\t\t${At}\n\t\t\t/>\n\t\t</g>\n\t\t`,t.setAttribute("viewBox","0 0 100 100"),t}fillDropdown(t){return!1}}class Nt extends Ot{constructor(t,e,n){super(t,e,n),this.tool=e}getTitle(){return this.localizationTable.select}createIcon(){const t=document.createElementNS(Dt,"svg");return t.innerHTML="\n\t\t<g>\n\t\t\t<rect x=10 y=10 width=70 height=70 fill='pink' stroke='black'/>\n\t\t\t<rect x=75 y=75 width=10 height=10 fill='white' stroke='black'/>\n\t\t</g>\n\t\t",t.setAttribute("viewBox","0 0 100 100"),t}fillDropdown(t){const e=document.createElement("div"),n=document.createElement("button");return n.innerText=this.localizationTable.resizeImageToSelection,n.disabled=!0,n.onclick=()=>{const t=this.tool.getSelection();this.editor.dispatch(this.editor.setImportExportRect(t.region))},this.editor.notifier.on(d.ToolUpdated,(t=>{if(t.kind!==d.ToolUpdated)throw new Error("Invalid event type!");if(t.tool===this.tool){const t=this.tool.getSelection(),e=t&&t.region.area>0;n.disabled=!e}})),e.replaceChildren(n),t.appendChild(e),!0}}class Vt extends Ot{getTitle(){return this.localizationTable.touchDrawing}createIcon(){const t=document.createElementNS(Dt,"svg");return t.innerHTML=`\n\t\t<g>\n\t\t\t<path d='M11,-30 Q0,10 20,20 Q40,20 40,-30 Z' fill='blue' stroke='black'/>\n\t\t\t<path d='\n\t\t\t\tM0,90 L0,50 Q5,40 10,50\n\t\t\t\tL10,20 Q20,15 30,20\n\t\t\t\tL30,50 Q50,40 80,50\n\t\t\t\tL80,90 L10,90 Z'\n\t\t\t\t\n\t\t\t\t${It}\n\t\t\t/>\n\t\t</g>\n\t\t`,t.setAttribute("viewBox","-10 -30 100 100"),t}fillDropdown(t){return!1}updateSelected(t){t?this.container.classList.remove("selected"):this.container.classList.add("selected")}}class Ft extends Ot{constructor(t,e,n,r){super(t,e,n),this.tool=e,this.penTypes=r,this.updateInputs=()=>{},this.editor.notifier.on(d.ToolUpdated,(t=>{if(t.kind!==d.ToolUpdated)throw new Error("Invalid event type!");t.tool===this.tool&&(this.updateIcon(),this.updateInputs())}))}getTitle(){return this.targetTool.description}makePenIcon(t){const e=Math.round(2*Math.sqrt(this.tool.getThickness())),n=this.tool.getColor(),r=`M14,63 L${50-e},95 L${50+e},90 L88,60 Z`,i=`M14,63 L${50-e},85 L${50+e},83 L88,60 Z`;t.innerHTML=`\n\t\t<defs>\n\t\t\t<pattern\n\t\t\t\tid='checkerboard'\n\t\t\t\tviewBox='0,0,10,10'\n\t\t\t\twidth='20%'\n\t\t\t\theight='20%'\n\t\t\t\tpatternUnits='userSpaceOnUse'\n\t\t\t>\n\t\t\t\t<rect x=0 y=0 width=10 height=10 fill='white'/>\n\t\t\t\t<rect x=0 y=0 width=5 height=5 fill='gray'/>\n\t\t\t\t<rect x=5 y=5 width=5 height=5 fill='gray'/>\n\t\t\t</pattern>\n\t\t</defs>\n\t\t<g>\n\t\t\t\x3c!-- Pen grip --\x3e\n\t\t\t<path\n\t\t\t\td='M10,10 L90,10 L90,60 L${50+e},80 L${50-e},80 L10,60 Z'\n\t\t\t\t${It}\n\t\t\t/>\n\t\t</g>\n\t\t<g>\n\t\t\t\x3c!-- Checkerboard background for slightly transparent pens --\x3e\n\t\t\t<path d='${i}' fill='url(#checkerboard)'/>\n\n\t\t\t\x3c!-- Actual pen tip --\x3e\n\t\t\t<path\n\t\t\t\td='${r}'\n\t\t\t\tfill='${n.toHexString()}'\n\t\t\t\tstroke='${n.toHexString()}'\n\t\t\t/>\n\t\t</g>\n\t\t`}makeDrawnIcon(t){const e=this.tool.getStrokeFactory(),r=this.tool.getThickness(),i=(new Date).getTime(),o={pos:n.of(10,10),width:r/5,color:this.tool.getColor(),time:i-100},s={pos:n.of(90,90),width:r/5,color:this.tool.getColor(),time:i},a=e(o,this.editor.viewport);a.addPoint(s);const l=new T(new xt);l.updateScreenSize(n.of(100,100));const c=new Ct(t,l);a.preview(c)}createIcon(){const t=document.createElementNS(Dt,"svg");t.setAttribute("viewBox","0 0 100 100");return this.tool.getStrokeFactory()===rt?this.makePenIcon(t):this.makeDrawnIcon(t),t}fillDropdown(t){const e=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div"),i=document.createElement("label"),o=document.createElement("input"),s=document.createElement("label"),a=document.createElement("select");o.id="toolbar-thicknessInput"+Ft.idCounter++,a.id="toolbar-builderSelect"+Ft.idCounter++,i.innerText=this.localizationTable.thicknessLabel,i.setAttribute("for",o.id),s.innerText=this.localizationTable.selectObjectType,s.setAttribute("for",a.id),o.type="range",o.min="1",o.max="20",o.step="1",o.oninput=()=>{this.tool.setThickness(Math.pow(parseFloat(o.value),2))},n.appendChild(i),n.appendChild(o),a.oninput=()=>{const t=parseInt(a.value);t<0||t>=this.penTypes.length?console.error("Invalid pen type index",t):this.tool.setStrokeFactory(this.penTypes[t].factory)},r.appendChild(s),r.appendChild(a);const l=document.createElement("div"),c=document.createElement("label"),h=document.createElement("input");return h.id="toolbar-colorInput"+Ft.idCounter++,c.innerText=this.localizationTable.colorLabel,c.setAttribute("for",h.id),h.className="coloris_input",h.type="button",h.oninput=()=>{this.tool.setColor(ft.fromHex(h.value))},h.addEventListener("open",(()=>{this.editor.notifier.dispatch(d.ColorPickerToggled,{kind:d.ColorPickerToggled,open:!0})})),h.addEventListener("close",(()=>{this.editor.notifier.dispatch(d.ColorPickerToggled,{kind:d.ColorPickerToggled,open:!1})})),l.appendChild(c),l.appendChild(h),this.updateInputs=()=>{h.value=this.tool.getColor().toHexString(),o.value=Math.sqrt(this.tool.getThickness()).toString(),a.replaceChildren();for(let t=0;t<this.penTypes.length;t++){const e=this.penTypes[t],n=document.createElement("option");n.value=t.toString(),n.innerText=e.name,a.appendChild(n),e.factory===this.tool.getStrokeFactory()&&(a.value=t.toString())}},this.updateInputs(),e.replaceChildren(l,n,r),t.replaceChildren(e),!0}}Ft.idCounter=0;class $t{constructor(t,e,n=$t.defaultLocalization){this.editor=t,this.localizationTable=n,this.container=document.createElement("div"),this.container.classList.add("toolbar-root"),this.container.setAttribute("role","toolbar"),e.appendChild(this.container),wt(),this.setupColorPickers(),this.penTypes=[{name:n.freehandPen,factory:rt},{name:n.arrowPen,factory:Et},{name:n.linePen,factory:zt},{name:n.filledRectanglePen,factory:Lt},{name:n.outlinedRectanglePen,factory:Rt}]}setupColorPickers(){const t=document.createElement("div");t.className="toolbar-closeColorPickerOverlay",this.editor.createHTMLOverlay(t),yt({el:".coloris_input",format:"hex",selectInput:!1,focusInput:!1,themeMode:"auto",swatches:[ft.red.toHexString(),ft.purple.toHexString(),ft.blue.toHexString(),ft.clay.toHexString(),ft.black.toHexString(),ft.white.toHexString()]}),this.editor.notifier.on(d.ColorPickerToggled,(e=>{e.kind===d.ColorPickerToggled&&(t.style.display=e.open?"block":"none")}))}addActionButton(t,e,n){const r=document.createElement("button");return r.innerText=t,r.classList.add("toolbar-toolButton"),r.onclick=e,(null!=n?n:this.container).appendChild(r),r}addUndoRedoButtons(){const t=document.createElement("div");t.classList.add("toolbar-buttonGroup");const e=this.addActionButton("Undo",(()=>{this.editor.history.undo()}),t),n=this.addActionButton("Redo",(()=>{this.editor.history.redo()}),t);this.container.appendChild(t),e.disabled=!0,n.disabled=!0,this.editor.notifier.on(d.UndoRedoStackUpdated,(t=>{if(t.kind!==d.UndoRedoStackUpdated)throw new Error("Wrong event type!");e.disabled=0===t.undoStackSize,n.disabled=0===t.redoStackSize}))}addDefaultToolWidgets(){const t=this.editor.toolController;for(const e of t.getMatchingTools(mt.Pen)){if(!(e instanceof ot))throw new Error("All `Pen` tools must have kind === ToolType.Pen");new Ft(this.editor,e,this.localizationTable,this.penTypes).addTo(this.container)}for(const e of t.getMatchingTools(mt.Eraser)){if(!(e instanceof lt))throw new Error("All Erasers must have kind === ToolType.Eraser!");new jt(this.editor,e,this.localizationTable).addTo(this.container)}for(const e of t.getMatchingTools(mt.Selection)){if(!(e instanceof pt))throw new Error("All SelectionTools must have kind === ToolType.Selection");new Nt(this.editor,e,this.localizationTable).addTo(this.container)}for(const e of t.getMatchingTools(mt.TouchPanZoom))new Vt(this.editor,e,this.localizationTable).addTo(this.container);this.setupColorPickers()}addDefaultActionButtons(){this.addUndoRedoButtons()}}$t.defaultLocalization={pen:"Pen",eraser:"Eraser",select:"Select",touchDrawing:"Touch Drawing",thicknessLabel:"Thickness: ",colorLabel:"Color: ",resizeImageToSelection:"Resize image to selection",undo:"Undo",redo:"Redo",selectObjectType:"Object type: ",freehandPen:"Freehand",arrowPen:"Arrow",linePen:"Line",outlinedRectanglePen:"Outlined rectangle",filledRectanglePen:"Filled rectangle",dropdownShown:t=>`Dropdown for ${t} shown`,dropdownHidden:t=>`Dropdown for ${t} hidden`};class Ut extends Pt{constructor(t,e){super(e),this.ctx=t,this.ignoreObjectsAboveLevel=null,this.ignoringObject=!1}displaySize(){return n.of(this.ctx.canvas.clientWidth,this.ctx.canvas.clientHeight)}clear(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}beginPath(t){t=this.viewport.canvasToScreen(t),this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y)}endPath(t){this.ctx.fillStyle=t.fill.toHexString(),this.ctx.fill(),t.stroke&&(this.ctx.strokeStyle=t.stroke.color.toHexString(),this.ctx.lineWidth=this.viewport.getScaleFactor()*t.stroke.width,this.ctx.stroke()),this.ctx.closePath()}lineTo(t){t=this.viewport.canvasToScreen(t),this.ctx.lineTo(t.x,t.y)}moveTo(t){t=this.viewport.canvasToScreen(t),this.ctx.moveTo(t.x,t.y)}traceCubicBezierCurve(t,e,n){t=this.viewport.canvasToScreen(t),e=this.viewport.canvasToScreen(e),n=this.viewport.canvasToScreen(n);const r=e.minus(t),i=n.minus(e);r.magnitudeSquared()<25&&i.magnitudeSquared()<25?this.ctx.lineTo(n.x,n.y):this.ctx.bezierCurveTo(t.x,t.y,e.x,e.y,n.x,n.y)}traceQuadraticBezierCurve(t,e){t=this.viewport.canvasToScreen(t),e=this.viewport.canvasToScreen(e);t.minus(e).magnitudeSquared()<25?this.ctx.lineTo(e.x,e.y):this.ctx.quadraticCurveTo(t.x,t.y,e.x,e.y)}drawPath(t){this.ignoringObject||super.drawPath(t)}startObject(t){const e=this.viewport.canvasToScreenTransform.transformVec3(t.size);Math.abs(e.x)<4&&Math.abs(e.y)<4&&(this.ignoreObjectsAboveLevel=this.getNestingLevel(),this.ignoringObject=!0),super.startObject(t)}endObject(){super.endObject(),null!==this.ignoreObjectsAboveLevel&&this.getNestingLevel()<=this.ignoreObjectsAboveLevel&&(this.ignoreObjectsAboveLevel=null,this.ignoringObject=!1)}drawPoints(...t){for(let e=0;e<t.length;e++){const n=this.viewport.canvasToScreen(t[e]);this.ctx.beginPath(),this.ctx.arc(n.x,n.y,10,0,2*Math.PI),this.ctx.fillStyle=ft.ofRGBA(.5+Math.sin(e)/2,1,.5+Math.cos(.2*e)/4,.5).toHexString(),this.ctx.fill(),this.ctx.stroke(),this.ctx.closePath(),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.ctx.fillText(`${e}`,n.x,n.y,20)}}}class _t extends Pt{constructor(t){super(t),this.clearedCount=0,this.renderedPathCount=0,this.lastFillStyle=null,this.lastPoint=null,this.objectNestingLevel=0,this.pointBuffer=[]}displaySize(){return n.of(640,480)}clear(){if(this.clearedCount++,this.renderedPathCount=0,this.pointBuffer=[],this.objectNestingLevel>0)throw new Error(`Within an object while clearing! Nesting level: ${this.objectNestingLevel}`)}beginPath(t){this.lastPoint=t,this.pointBuffer.push(t)}endPath(t){this.renderedPathCount++,this.lastFillStyle=t}lineTo(t){this.lastPoint=t,this.pointBuffer.push(t)}moveTo(t){this.lastPoint=t,this.pointBuffer.push(t)}traceCubicBezierCurve(t,e,n){this.lastPoint=n,this.pointBuffer.push(t,e,n)}traceQuadraticBezierCurve(t,e){this.lastPoint=e,this.pointBuffer.push(t,e)}drawPoints(...t){}startObject(t){super.startObject(t),this.objectNestingLevel+=1}endObject(){super.endObject(),this.objectNestingLevel-=1}}var Wt;!function(t){t[t.DummyRenderer=0]="DummyRenderer",t[t.CanvasRenderer=1]="CanvasRenderer"}(Wt||(Wt={}));class Gt{constructor(t,e,n){this.editor=t,this.parent=n,e===Wt.CanvasRenderer?this.initializeCanvasRendering():(this.dryInkRenderer=new _t(t.viewport),this.wetInkRenderer=new _t(t.viewport)),this.editor.notifier.on(d.DisplayResized,(t=>{var e;if(t.kind!==d.DisplayResized)throw new Error("Mismatched event.kinds!");null===(e=this.resizeSurfacesCallback)||void 0===e||e.call(this)}))}get width(){return this.dryInkRenderer.displaySize().x}get height(){return this.dryInkRenderer.displaySize().y}initializeCanvasRendering(){const t=document.createElement("canvas"),e=document.createElement("canvas"),r=t.getContext("2d"),i=e.getContext("2d");this.dryInkRenderer=new Ut(r,this.editor.viewport),this.wetInkRenderer=new Ut(i,this.editor.viewport),t.className="dryInkCanvas",e.className="wetInkCanvas",this.parent&&(this.parent.appendChild(t),this.parent.appendChild(e)),this.resizeSurfacesCallback=()=>{const r=t=>t.clientHeight!==t.height||t.clientWidth!==t.width;(r(t)||r(e))&&(t.width=t.clientWidth,t.height=t.clientHeight,e.width=e.clientWidth,e.height=e.clientHeight,this.editor.notifier.dispatch(d.DisplayResized,{kind:d.DisplayResized,newSize:n.of(this.width,this.height)}))},this.resizeSurfacesCallback(),this.flattenCallback=()=>{r.drawImage(e,0,0)}}startRerender(){var t;return null===(t=this.resizeSurfacesCallback)||void 0===t||t.call(this),this.wetInkRenderer.clear(),this.dryInkRenderer.clear(),this.dryInkRenderer}getDryInkRenderer(){return this.dryInkRenderer}getWetInkRenderer(){return this.wetInkRenderer}flatten(){var t;null===(t=this.flattenCallback)||void 0===t||t.call(this)}}class Ht extends et{constructor(t){super(),this.svgObject=t,this.contentBBox=s.of(t.getBoundingClientRect())}render(t,e){t instanceof Ct&&t.drawSVGElem(this.svgObject)}intersects(t){return this.contentBBox.getEdges().some((e=>null!==e.intersection(t)))}applyTransformation(t){}description(t){return t.svgObject}}var Zt=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};const qt=new s(0,0,500,500);class Xt{constructor(t,e){this.source=t,this.onFinish=e,this.onAddComponent=null,this.onProgress=null,this.processedCount=0,this.totalToProcess=0}getStyle(t){var e,n,r;const i={fill:ft.transparent},o=null!==(e=t.getAttribute("fill"))&&void 0!==e?e:t.style.fill;if(o)try{i.fill=ft.fromString(o)}catch(t){console.error("Unknown fill color,",o)}const s=null!==(n=t.getAttribute("stroke"))&&void 0!==n?n:t.style.stroke,a=null!==(r=t.getAttribute("stroke-width"))&&void 0!==r?r:t.style.strokeWidth;if(s)try{let t=parseFloat(null!=a?a:"1");isFinite(t)||(t=0),i.stroke={width:t,color:ft.fromString(s)}}catch(t){console.error("Error parsing stroke data:",t)}return i}strokeDataFromElem(t){var e;const n=[],r=null!==(e=t.getAttribute("d"))&&void 0!==e?e:"",i=this.getStyle(t),o=r.split("M");let s=!0;for(const t of o){if(""!==t){const e=s?t:`M${t}`,r=tt.fromString(e).toRenderable(i);n.push(r)}s=!1}return n}addPath(t){var e;let n;try{const e=this.strokeDataFromElem(t);n=new nt(e)}catch(e){console.error("Invalid path in node",t,"\nError:",e,"\nAdding as an unknown object."),n=new Ht(t)}null===(e=this.onAddComponent)||void 0===e||e.call(this,n)}addUnknownNode(t){var e;const n=new Ht(t);null===(e=this.onAddComponent)||void 0===e||e.call(this,n)}updateViewBox(t){const e=t.getAttribute("viewBox");if(this.rootViewBox||!e)return;const n=e.split(/[ \t,]/),r=parseFloat(n[0]),i=parseFloat(n[1]),o=parseFloat(n[2]),a=parseFloat(n[3]);isNaN(r)||isNaN(i)||isNaN(o)||isNaN(a)||(this.rootViewBox=new s(r,i,o,a))}visit(t){var e;return Zt(this,void 0,void 0,(function*(){switch(this.totalToProcess+=t.childElementCount,t.tagName.toLowerCase()){case"g":break;case"path":this.addPath(t);break;case"svg":this.updateViewBox(t);break;default:return console.warn("Unknown SVG element,",t),t instanceof SVGElement||console.warn("Element",t,"is not an SVGElement! Continuing anyway."),void this.addUnknownNode(t)}for(const e of t.children)yield this.visit(e);this.processedCount++,yield null===(e=this.onProgress)||void 0===e?void 0:e.call(this,this.processedCount,this.totalToProcess)}))}start(t,e){var n;return Zt(this,void 0,void 0,(function*(){this.onAddComponent=t,this.onProgress=e,this.totalToProcess=this.source.childElementCount,this.processedCount=0,this.rootViewBox=null,yield this.visit(this.source);const r=this.rootViewBox;let i=qt;return r&&(i=s.of(r)),null===(n=this.onFinish)||void 0===n||n.call(this),i}))}static fromString(t){var e,n;const r=document.createElement("iframe");if(r.src="about:blank",r.setAttribute("sandbox","allow-same-origin"),r.setAttribute("csp","default-src 'about:blank'"),r.style.display="none",document.body.appendChild(r),!r.hasAttribute("sandbox"))throw r.remove(),new Error("SVG loading iframe is not sandboxed.");const i=null!==(n=null===(e=r.contentWindow)||void 0===e?void 0:e.document)&&void 0!==n?n:r.contentDocument;if(null==i)throw new Error("Unable to open a sandboxed iframe!");i.open(),i.write("\n\t\t\t<!DOCTYPE html>\n\t\t\t<html>\n\t\t\t\t<head>\n\t\t\t\t\t<title>SVG Loading Sandbox</title>\n\t\t\t\t</head>\n\t\t\t\t<body>\n\t\t\t\t\t<script>\n\t\t\t\t\t\tconsole.error('JavaScript should not be able to run here!');\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t'The SVG sandbox is broken! Please double-check the sandboxing setting.'\n\t\t\t\t\t\t);\n\t\t\t\t\t<\/script>\n\t\t\t\t</body>\n\t\t\t</html>\n\t\t"),i.close();const o=i.createElementNS("http://www.w3.org/2000/svg","svg");return o.innerHTML=t,new Xt(o,(()=>{r.remove()}))}}const Yt={updatedViewport:"Transformed Viewport",transformedElements:t=>`Transformed ${t} element${1===t?"":"s"}`,resizeOutputCommand:t=>`Resized image to ${t.w}x${t.h}`,addElementAction:t=>`Added ${t}`,eraseAction:(t,e)=>`Erased ${e} ${t}`,elements:"Elements",erasedNoElements:"Erased nothing",rotatedBy:t=>`Rotated by ${Math.abs(t)} degrees ${t<0?"clockwise":"counter-clockwise"}`,movedLeft:"Moved left",movedUp:"Moved up",movedDown:"Moved down",movedRight:"Moved right",zoomedOut:"Zoomed out",zoomedIn:"Zoomed in",selectedElements:t=>`Selected ${t} element${1===t?"":"s"}`},Qt=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},$t.defaultLocalization),{penTool:t=>`Pen ${t}`,selectionTool:"Selection",eraserTool:"Eraser",touchPanTool:"Touch Panning",twoFingerPanZoomTool:"Panning and Zooming",toolEnabledAnnouncement:t=>`${t} enabled`,toolDisabledAnnouncement:t=>`${t} disabled`}),Yt),{stroke:"Stroke",svgObject:"SVG Object"}),{loading:t=>`Loading ${t}%...`,imageEditor:"Image Editor",doneLoading:"Done loading",undoAnnouncement:t=>`Undid ${t}`,redoAnnouncement:t=>`Redid ${t}`});var Kt=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))};const Jt=class{constructor(t,e=Wt.CanvasRenderer,r){this.localization=Qt,this.announceUndoCallback=t=>{this.announceForAccessibility(this.localization.undoAnnouncement(t.description(this.localization)))},this.announceRedoCallback=t=>{this.announceForAccessibility(this.localization.redoAnnouncement(t.description(this.localization)))},this.rerenderQueued=!1,this.container=document.createElement("div"),this.renderingRegion=document.createElement("div"),this.container.appendChild(this.renderingRegion),this.container.className="imageEditorContainer",this.localization=Object.assign(Object.assign({},this.localization),r),this.loadingWarning=document.createElement("div"),this.loadingWarning.classList.add("loadingMessage"),this.loadingWarning.ariaLive="polite",this.container.appendChild(this.loadingWarning),this.accessibilityAnnounceArea=document.createElement("div"),this.accessibilityAnnounceArea.ariaLive="assertive",this.accessibilityAnnounceArea.className="accessibilityAnnouncement",this.container.appendChild(this.accessibilityAnnounceArea),this.renderingRegion.style.touchAction="none",this.renderingRegion.className="imageEditorRenderArea",this.renderingRegion.setAttribute("tabIndex","0"),this.renderingRegion.ariaLabel=this.localization.imageEditor,this.notifier=new xt,this.importExportViewport=new T(this.notifier),this.viewport=new T(this.notifier),this.display=new Gt(this,e,this.renderingRegion),this.image=new m,this.history=new vt(this,this.announceRedoCallback,this.announceUndoCallback),this.toolController=new gt(this,this.localization),t.appendChild(this.container),this.importExportViewport.updateScreenSize(n.of(500,500)),this.viewport.updateScreenSize(n.of(this.display.width,this.display.height)),this.registerListeners(),this.rerender(),this.hideLoadingWarning()}showLoadingWarning(t){const e=Math.round(100*t);this.loadingWarning.innerText=this.localization.loading(e),this.loadingWarning.style.display="block"}hideLoadingWarning(){this.loadingWarning.style.display="none",this.announceForAccessibility(this.localization.doneLoading)}announceForAccessibility(t){this.accessibilityAnnounceArea.innerText=t}addToolbar(t=!0){const e=new $t(this,this.container,this.localization);return t&&(e.addDefaultToolWidgets(),e.addDefaultActionButtons()),e}registerListeners(){const t={},r=()=>{const e=(new Date).getTime(),n=[];for(const r in t){const i=2e3;t[r]&&e-t[r].timeStamp<i&&n.push(t[r])}return n};this.renderingRegion.addEventListener("touchstart",(t=>t.preventDefault())),this.renderingRegion.addEventListener("pointerdown",(e=>{const n=x.ofEvent(e,!0,this.viewport);t[n.id]=n,this.renderingRegion.setPointerCapture(n.id);const i={kind:h.PointerDownEvt,current:n,allPointers:r()};return this.toolController.dispatchInputEvent(i),!0})),this.renderingRegion.addEventListener("pointermove",(e=>{var n,i;const o=x.ofEvent(e,null!==(i=null===(n=t[e.pointerId])||void 0===n?void 0:n.down)&&void 0!==i&&i,this.viewport);o.down&&(t[o.id]=o,this.toolController.dispatchInputEvent({kind:h.PointerMoveEvt,current:o,allPointers:r()})&&e.preventDefault())}));const i=e=>{const n=x.ofEvent(e,!1,this.viewport);t[n.id]&&(t[n.id]=n,this.renderingRegion.releasePointerCapture(n.id),this.toolController.dispatchInputEvent({kind:h.PointerUpEvt,current:n,allPointers:r()})&&e.preventDefault(),delete t[n.id])};this.renderingRegion.addEventListener("pointerup",(t=>{i(t)})),this.renderingRegion.addEventListener("pointercancel",(t=>{i(t)})),this.renderingRegion.addEventListener("keydown",(t=>{this.toolController.dispatchInputEvent({kind:h.KeyPressEvent,key:t.key})&&t.preventDefault()})),this.container.addEventListener("wheel",(t=>{let r=e.of(t.deltaX,t.deltaY,t.deltaZ);t.deltaMode===WheelEvent.DOM_DELTA_LINE?r=r.times(15):t.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(r=r.times(100)),t.ctrlKey&&(r=e.of(0,0,t.deltaY));const i=n.of(t.clientX,t.clientY);return!!this.toolController.dispatchInputEvent({kind:h.WheelEvt,delta:r,screenPos:i})&&(t.preventDefault(),!0)})),this.notifier.on(d.DisplayResized,(t=>{this.viewport.updateScreenSize(n.of(this.display.width,this.display.height))})),window.addEventListener("resize",(()=>{this.notifier.dispatch(d.DisplayResized,{kind:d.DisplayResized,newSize:n.of(this.display.width,this.display.height)}),this.queueRerender()}))}dispatch(t,e=!0){e?this.history.push(t):t.apply(this),this.announceForAccessibility(t.description(this.localization))}asyncApplyOrUnapplyCommands(t,e,n){return Kt(this,void 0,void 0,(function*(){for(let r=0;r<t.length;r+=n){this.showLoadingWarning(r/t.length);for(let i=r;i<t.length&&i<r+n;i++){const n=t[i];e?n.apply(this):n.unapply(this)}r+n<t.length&&(yield new Promise((t=>{this.rerender(),requestAnimationFrame(t)})))}this.hideLoadingWarning()}))}asyncApplyCommands(t,e){return this.asyncApplyOrUnapplyCommands(t,!0,e)}asyncUnapplyCommands(t,e){return this.asyncApplyOrUnapplyCommands(t,!1,e)}queueRerender(){this.rerenderQueued||(this.rerenderQueued=!0,requestAnimationFrame((()=>{this.rerender(),this.rerenderQueued=!1})))}rerender(t=!0){this.display.startRerender();const e=this.display.getDryInkRenderer();if(t){const t={fill:ft.fromHex("#44444455")},n=12;e.drawRect(this.importExportViewport.visibleRect,n,t)}this.image.render(e,this.viewport),this.rerenderQueued=!1}drawWetInk(...t){for(const e of t)this.display.getWetInkRenderer().drawPath(e)}clearWetInk(){this.display.getWetInkRenderer().clear()}createHTMLOverlay(t){return t.classList.add("overlay"),this.container.appendChild(t),{remove:()=>t.remove()}}addStyleSheet(t){const e=document.createElement("style");return e.innerText=t,this.container.appendChild(e),e}sendPenEvent(t,e,n){const r=x.ofCanvasPoint(e,t!==h.PointerUpEvt,this.viewport);this.toolController.dispatchInputEvent({kind:t,allPointers:null!=n?n:[r],current:r})}toSVG(){const t=this.importExportViewport,e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"svg"),r=new Ct(n,t),i=t.canvasToScreenTransform;t.resetTransform(v.identity),this.image.renderAll(r),t.resetTransform(i);const o=t.visibleRect;return n.setAttribute("viewBox",`${o.x} ${o.y} ${o.w} ${o.h}`),n.setAttribute("width",`${o.w}`),n.setAttribute("height",`${o.h}`),n.setAttribute("version","1.1"),n.setAttribute("baseProfile","full"),n.setAttribute("xmlns",e),n}loadFrom(t){return Kt(this,void 0,void 0,(function*(){this.showLoadingWarning(0);const e=yield t.start((t=>{new m.AddElementCommand(t).apply(this)}),((t,e)=>t%100==0?(this.showLoadingWarning(t/e),this.rerender(!1),new Promise((t=>{requestAnimationFrame((()=>t()))}))):null));this.hideLoadingWarning(),this.setImportExportRect(e).apply(this)}))}getImportExportRect(){return this.importExportViewport.visibleRect}setImportExportRect(t){const e=this.importExportViewport.visibleRect.size,n=this.importExportViewport.canvasToScreenTransform;return{apply(e){const n=e.importExportViewport;n.updateScreenSize(t.size),n.resetTransform(v.translation(t.topLeft.times(-1))),e.queueRerender()},unapply(t){const r=t.importExportViewport;r.updateScreenSize(e),r.resetTransform(n),t.queueRerender()},description:e=>e.resizeOutputCommand(t)}}loadFromSVG(t){return Kt(this,void 0,void 0,(function*(){const e=Xt.fromString(t);yield this.loadFrom(e)}))}};var te=r(379),ee=r.n(te),ne=r(795),re=r.n(ne),ie=r(569),oe=r.n(ie),se=r(565),ae=r.n(se),le=r(216),ce=r.n(le),he=r(589),de=r.n(he),ue=r(287),pe={};pe.styleTagTransform=de(),pe.setAttributes=ae(),pe.insert=oe().bind(null,"head"),pe.domAPI=re(),pe.insertStyleElement=ce();ee()(ue.Z,pe);ue.Z&&ue.Z.locals&&ue.Z.locals;var fe=r(329),me={};me.styleTagTransform=de(),me.setAttributes=ae(),me.insert=oe().bind(null,"head"),me.domAPI=re(),me.insertStyleElement=ce();ee()(fe.Z,me);fe.Z&&fe.Z.locals&&fe.Z.locals;const ge="lastSave";(()=>{const t=document.querySelector("#alertOnError"),e=document.querySelector("#initialData"),n=document.querySelector("#initialFile"),r=document.querySelector("#startButton"),i=document.querySelector("#editorOptions"),o="Load from last save (if available)";e.value=o;let s=null;n.value="",n.onchange=()=>{var t;e.value="...";const r=null!==(t=n.files)&&void 0!==t?t:[];if(r.length>1)return void alert("Too many files!");if(0===r.length)return;const i=new FileReader;i.onload=t=>{var n;(null===(n=t.target)||void 0===n?void 0:n.result)&&(e.value="Load from selected file",s=t.target.result)},i.readAsText(r[0])},r.onclick=()=>{var n,r;const a=e.value,l=t.checked;i.remove(),l&&(()=>{const t=document.querySelector("#logOutput");t.style.display="block",t.value="\n\nIf enabled, errors will be logged to this textarea.\n\n\n\t";const e=()=>{t.scrollTop=t.scrollHeight};window.onerror=n=>{t.value+="\nError thrown: "+n+"\n",e()};const n=console.error;console.error=(...r)=>{n.apply(console,r),t.value+="\nError logged: "+r.join(", ")+"\n",e()}})();const c=(t=>{const e=document.body,n=new Jt(e);return n.addToolbar().addActionButton("Save",(()=>{t()})),n})((()=>(t=>{const e=window.open();if(null===e)throw new Error("Unable to open save popup!");const n=t.toSVG(),r=n.outerHTML;e.document.open(),e.document.write("\n\t\t<!DOCTYPE html>\n\t\t<html>\n\t\t<head>\n\t\t\t<meta name='viewport' content='initial-scale=1.0'/>\n\t\t\t<meta charset='utf-8'/>\n\t\t</head>\n\t\t<body>\n\t\t\t<style>\n\t\t\t\t#previewRegion {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: row;\n\t\t\t\t}\n\n\t\t\t\tsvg {\n\t\t\t\t\theight: auto;\n\t\t\t\t\twidth: auto;\n\t\t\t\t\tmax-width: 500px;\n\t\t\t\t\tmax-height: 100vh;\n\t\t\t\t\tflex-grow: 1;\n\t\t\t\t\tborder: 1px solid gray;\n\t\t\t\t}\n\n\t\t\t\ttextarea {\n\t\t\t\t\tflex-grow: 1;\n\t\t\t\t\tflex-shrink: 1;\n\t\t\t\t\twidth: auto;\n\t\t\t\t}\n\t\t\t</style>\n\t\t\t<p>\n\t\t\t\t⚠ Warning ⚠: Some browsers won't save images over 2.5-ish MiB!\n\t\t\t</p>\n\t\t\t<div id='previewRegion'>\n\t\t\t\t<p>Saving to <code>localStorage</code>...</p>\n\t\t\t</div>\n\t\t</body>\n\t\t</html>"),e.document.close();const i=e.document.querySelector("#previewRegion"),o=e.document.createElement("button");o.innerText="View generated SVG image",o.onclick=()=>{var t;const o=e.document.createElement("p"),s=e.document.createElement("textarea"),a=e.document.createElementNS("http://www.w3.org/2000/svg","svg");a.innerHTML=n.innerHTML,a.setAttribute("viewBox",null!==(t=n.getAttribute("viewBox"))&&void 0!==t?t:""),o.innerText="Preview: ",s.value=r,i.replaceChildren(o,s,a)};const s=e.document.createElement("button");s.innerText="Download",s.onclick=()=>{const t=new Blob([r],{type:"image/svg"}),n=URL.createObjectURL(t),i=e.document.createElement("a");i.href=n,i.innerText="Download",i.setAttribute("download","editor-save.svg"),s.replaceWith(i),i.click(),i.remove(),URL.revokeObjectURL(n)},e.document.body.appendChild(s);let a="Unable to save to localStorage. ";window.localStorage&&(window.localStorage.setItem(ge,r),a="Saved to localStorage! ");let l=Math.round(r.length/1024*10)/10+" KiB";r.length>1048576&&(l=Math.round(r.length/1024*10/1024)/10+" MiB"),i.replaceChildren(e.document.createTextNode(a),e.document.createTextNode(`Image size: ${l}.`),o)})(c)));null!=s||(s=a),s===o&&(s=null!==(r=null===(n=window.localStorage)||void 0===n?void 0:n.getItem(ge))&&void 0!==r?r:""),s&&s.length>0&&c.loadFromSVG(s)}})()})(),window.jsdraw=i})();